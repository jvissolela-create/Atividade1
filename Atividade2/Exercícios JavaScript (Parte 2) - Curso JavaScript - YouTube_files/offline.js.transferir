(function(g){var window=this;'use strict';var Gy6=function(m){var M=new g.w6("und",new g.wl("Default","und",!0));M.captionTracks=m.captionTracks;return M},aiT=function(m){return new g.Ea(function(M,e){var I=m.length,t=[];
if(I)for(var Y=function(Z,F){I--;t[Z]=F;I==0&&M(t)},b=function(Z){e(Z)},r,q=0;q<m.length;q++)r=m[q],g.CpE(r,g.Tl(Y,q),b);
else M(t)})},z2=function(m){this.L=m},T2=function(){z2.apply(this,arguments)},dol=function(){T2.apply(this,arguments)},O0g=function(){T2.apply(this,arguments)},Lld=function(){T2.apply(this,arguments)},vC9=function(){T2.apply(this,arguments)},gCg=function(){T2.apply(this,arguments)},Klg=function(){T2.apply(this,arguments)},mPd=function(){T2.apply(this,arguments)},M6s=function(){z2.apply(this,arguments)},e4C=function(){T2.apply(this,arguments)},Isu=function(){T2.apply(this,arguments)},t6T=function(){T2.apply(this,
arguments)},YZK=function(){T2.apply(this,arguments)},bhK=function(){T2.apply(this,arguments)},QGS=function(){T2.apply(this,arguments)},sGg=function(){T2.apply(this,arguments)},rE9=function(){T2.apply(this,arguments)},qZ6=function(){T2.apply(this,arguments)},Zh6=function(){T2.apply(this,arguments)},Fgl=function(){T2.apply(this,arguments)},CpT=function(){T2.apply(this,arguments)},HhC=function(){z2.apply(this,arguments)},R4Z=function(){T2.apply(this,arguments)},Wgd=function(){T2.apply(this,arguments)},
kLT=function(){T2.apply(this,arguments)},UPS=function(){T2.apply(this,arguments)},V6u=function(){T2.apply(this,arguments)},NL6=function(){T2.apply(this,arguments)},cEu=function(){T2.apply(this,arguments)},jGS=function(){T2.apply(this,arguments)},ihT=function(){T2.apply(this,arguments)},yEd=function(){z2.apply(this,arguments)},JEl=function(){z2.apply(this,arguments)},fsC=function(){z2.apply(this,arguments)},uA6=function(){T2.apply(this,arguments)},SZC=function(){T2.apply(this,arguments)},End=function(){T2.apply(this,
arguments)},nnK=function(){T2.apply(this,arguments)},PpK=function(){T2.apply(this,arguments)},BLS=function(){T2.apply(this,arguments)},h40=function(){T2.apply(this,arguments)},wmu=function(){T2.apply(this,arguments)},onu=function(){T2.apply(this,arguments)},z4C=function(){T2.apply(this,arguments)},TLC=function(){T2.apply(this,arguments)},Xm6=function(){T2.apply(this,arguments)},pmy=function(){T2.apply(this,arguments)},ls6=function(){T2.apply(this,arguments)},xPd=function(){T2.apply(this,arguments)},
AEZ=function(){T2.apply(this,arguments)},DPK=function(){T2.apply(this,arguments)},$Pu=function(){T2.apply(this,arguments)},GL6=function(){T2.apply(this,arguments)},asS=function(){T2.apply(this,arguments)},dPf=function(){T2.apply(this,arguments)},Ohu=function(){T2.apply(this,arguments)},LgC=function(){T2.apply(this,arguments)},vnT=function(){T2.apply(this,arguments)},gnS=function(){T2.apply(this,arguments)},Kgf=function(){T2.apply(this,arguments)},mbT=function(){T2.apply(this,arguments)},MqT=function(){T2.apply(this,
arguments)},eWC=function(){T2.apply(this,arguments)},IFC=function(){z2.apply(this,arguments)},tq6=function(){T2.apply(this,arguments)},YSl=function(){T2.apply(this,arguments)},bUs=function(){T2.apply(this,arguments)},Q5u=function(){T2.apply(this,arguments)},s5s=function(){T2.apply(this,arguments)},r5f=function(){T2.apply(this,arguments)},qSC=function(){T2.apply(this,arguments)},ZUu=function(){T2.apply(this,arguments)},FU0=function(){T2.apply(this,arguments)},CCT=function(){T2.apply(this,arguments)},
HUg=function(){T2.apply(this,arguments)},RWu=function(){T2.apply(this,arguments)},WUS=function(){T2.apply(this,arguments)},kUg=function(){T2.apply(this,arguments)},Ub9=function(){T2.apply(this,arguments)},VqT=function(){T2.apply(this,arguments)},NT6=function(){T2.apply(this,arguments)},c5S=function(){T2.apply(this,arguments)},j5Z=function(){T2.apply(this,arguments)},iU6=function(){T2.apply(this,arguments)},y56=function(){T2.apply(this,arguments)},J5l=function(){T2.apply(this,arguments)},fFZ=function(){T2.apply(this,
arguments)},uxT=function(){T2.apply(this,arguments)},SSy=function(){T2.apply(this,arguments)},EZ0=function(){T2.apply(this,arguments)},nZy=function(){T2.apply(this,arguments)},PCd=function(){T2.apply(this,arguments)},BT6=function(){T2.apply(this,arguments)},hWl=function(){T2.apply(this,arguments)},w_T=function(){T2.apply(this,arguments)},oZy=function(){T2.apply(this,arguments)},zWK=function(){T2.apply(this,arguments)},TTu=function(){T2.apply(this,arguments)},X_9=function(m){m=m.key||m.id;
if(!m)throw Error("Entity key is missing");return m},p_u=function(){if(XY)return XY();
var m={};XY=g.tL("PersistentEntityStoreDb",{v9:(m.EntityStore={FX:1},m.EntityAssociationStore={FX:2},m),shared:!1,upgrade:function(M,e){e(1)&&g.zX(g.nC(M,"EntityStore",{keyPath:"key"}),"entityType","entityType");e(2)&&(M=g.nC(M,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.zX(M,"byParentEntityKey","parentEntityKey"),g.zX(M,"byChildEntityKey","childEntityKey"))},
version:3});return XY()},lF0=function(m){return g.GX(p_u(),m)},xb0=function(m){return g.GX((0,g.C2K)(),m)},pl=function(m){this.token=m},lN=function(m,M){M=M===void 0?{}:M;
g.fO.call(this,g.H5f[m],Object.assign({},{name:"PESEncoderError",type:m},M));this.type=m;this.level="WARNING";Object.setPrototypeOf(this,lN.prototype)},A5f=function(m){return new lN("WRONG_DATA_TYPE",{YJ:m})},Db0=function(m){return m instanceof Error?new lN("UNKNOWN_ENCODE_ERROR",{originalMessage:m.message}):new lN("UNKNOWN_ENCODE_ERROR")},$bS=function(m){return m instanceof Error?new lN("UNKNOWN_DECODE_ERROR",{originalMessage:m.message}):new lN("UNKNOWN_DECODE_ERROR")},GUK=function(m,M){m=m instanceof
lN?m:M(m);
g.PD(m);throw m;},aFl=function(){},db9=function(m,M,e){try{return m.D(M,e)}catch(I){GUK(I,Db0)}},OUy=function(m){m=(new TextEncoder).encode(m).subarray(0,16);
var M=new Uint8Array(16);M.set(m);return M},x9=function(m){this.L=m},vZT=function(m){var M=LUu[m];
if(M)return M;g.hy(new g.fO("Entity model not found.",{entityType:m}))},gZu=function(m,M){this.L=m;
this.Y=M;this.D={}},myT=function(m,M){a:{m=KUT(m.Y,M.version);
try{var e=m.Y(M.data,M.key);break a}catch(I){GUK(I,$bS)}e=void 0}return e},A3=function(m,M,e){return m.L.objectStore("EntityStore").get(M).then(function(I){if(I){if(e&&I.entityType!==e)throw Error("Incorrect entity type");
return myT(m,I)}})},DQ=function(m,M,e){return e?(e=e.map(function(I){return A3(m,I,M)}),g.iR.all(e)):m.L.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(M)).then(function(I){return I.map(function(t){return myT(m,t)})})},G2=function(m,M,e){var I=X_9(M),t=KUT(m.Y,1),Y=Object.assign({},M);
return m.L.objectStore("EntityStore").get(I).then(function(b){if(b){if(b.entityType!==e)throw Error("Incorrect entity type");Y.entityMetadata||(b=myT(m,b),Y.entityMetadata=b.entityMetadata)}}).then(function(){var b={key:I,
entityType:e,data:db9(t,Y,I),version:1};return g.iR.all([g.hu(m.L.objectStore("EntityStore"),b),MUZ(m,Y,e)])}).then(function(){$9(m,I,e);
return I})},e7l=function(m,M,e){M=M.map(function(I){return G2(m,I,e)});
return g.iR.all(M)},ak=function(m,M,e){if(e==null?0:e.MA){var I=new Set;
return IHg(m,M,I).then(function(){for(var Y=[],b=g.P(I),r=b.next();!r.done;r=b.next())Y.push(ak(m,r.value));return g.iR.all(Y).then(function(){})})}var t=g.aK(M).entityType;
return g.iR.all([m.L.objectStore("EntityStore").delete(M),tUy(m,M)]).then(function(){$9(m,M,t)})},YOf=function(m,M){return g.lR(m.L.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(M)},function(e){return g.iR.all([e.delete(),
tUy(m,e.cursor.primaryKey)]).then(function(){$9(m,e.cursor.primaryKey,M);return g.Xg(e)})})},bP9=function(m,M,e,I){var t=KUT(m.Y,1);
return A3(m,M,I).then(function(Y){if(Y){Y=g.qR(Y,e);var b={key:M,entityType:I,data:db9(t,Y,M),version:1};return g.iR.all([g.hu(m.L.objectStore("EntityStore"),b),MUZ(m,Y,I)])}}).then(function(){$9(m,M,I);
return M})},$9=function(m,M,e){var I=m.D[e];
I||(I=new Set,m.D[e]=I);I.add(M)},QAs=function(m,M,e){var I=X_9(M);
e=vZT(e);if(!e)return g.iR.resolve([]);e=new e(M);m=m.L.objectStore("EntityAssociationStore");M=[];e=g.P(e.Y());for(var t=e.next();!t.done;t=e.next())M.push(g.hu(m,{parentEntityKey:I,childEntityKey:t.value}));return g.iR.all(M).then(function(Y){return Y.map(function(b){return b[1]})})},tUy=function(m,M){return m.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M))},MUZ=function(m,M,e){var I=X_9(M);
return tUy(m,I).then(function(){return QAs(m,M,e)})},IHg=function(m,M,e){if(e.has(M))return g.iR.resolve(void 0);
e.add(M);return sAK(m,M).then(function(I){return m.L.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(M)).then(function(){return I})}).then(function(I){var t=g.iR.resolve(void 0);
I=g.P(I);for(var Y=I.next(),b={};!Y.done;b={KN:void 0},Y=I.next())b.KN=Y.value,t=t.then(function(r){return function(){return IHg(m,r.KN,e)}}(b));
return t}).then(function(){})},sAK=function(m,M){var e=m.L.objectStore("EntityAssociationStore");
return e.index("byParentEntityKey").getAll(IDBKeyRange.only(M)).then(function(I){var t=[];I=g.P(I);for(var Y=I.next();!Y.done;Y=I.next())Y=Y.value,t.push(e.index("byChildEntityKey").getAll(Y.childEntityKey));return g.iR.all(t)}).then(function(I){var t=[];
I=g.P(I);for(var Y=I.next();!Y.done;Y=I.next())Y=Y.value,Y.length===1&&t.push(Y[0].childEntityKey);return t})},dC=function(){},rMK=function(){this.L={};
this.L[0]=new dC;if(!g.un("aes_pes_encoder_killswitch")){var m=this.L;try{var M=g.vW();var e=OUy(M);var I=new x9(new g.sR(e),new g.r9(e))}catch(t){throw m=t instanceof Error?new lN("KEY_CREATION_FAILED",{originalMessage:t.message}):new lN("KEY_CREATION_FAILED"),g.PD(m),m;}m[1]=I}},KUT=function(m,M){M=M===void 0?0:M;
m=m.L[M];if(!m)throw M=new lN("INVALID_ENCODER_VERSION",{YJ:M}),g.PD(M),M;return m},O$=function(m,M){g.A.call(this);
this.token=m;this.L=M;this.observers=[];m=new g.cS.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.vW());m.onmessage=this.Y.bind(this);this.channel=m},Ll=function(m,M,e){var I,t,Y,b;
return g.p(function(r){if(r.L==1)return g.T(r,lF0(m.token),2);if(r.L!=3)return I=r.Y,g.T(r,g.Bo(I,["EntityStore","EntityAssociationStore"],M,function(q){t=new gZu(q,m.L);return e(t)}),3);
Y=r.Y;t&&(b=t.D,Object.keys(b).length>0&&(m.channel.postMessage(b),qOZ(m,b)));return r.return(Y)})},vz=function(m,M,e){return Ll(m,{mode:"readwrite",
uS:!0},function(I){return G2(I,M,e)})},ZP0=function(m,M){return Ll(m,{mode:"readwrite",
uS:!0},function(e){return e7l(e,M,"offlineOrchestrationActionWrapperEntity")})},FVs=function(m,M){return Ll(m,{mode:"readwrite",
uS:!0},function(e){return ak(e,M)})},Cog=function(m){return Ll(m,{mode:"readwrite",
uS:!0},function(M){return YOf(M,"videoPlaybackPositionEntity")})},gC=function(m,M,e){return Ll(m,{mode:"readonly",
uS:!0},function(I){return A3(I,M,e)})},Kl=function(m,M,e){return Ll(m,{mode:"readonly",
uS:!0},function(I){return DQ(I,M,e)})},qOZ=function(m,M){m=g.P(m.observers);
for(var e=m.next();!e.done;e=m.next())e=e.value,e(M)},HPl=function(){var m,M,e;
return g.p(function(I){if(I.L==1)return g.bf(I,2),g.T(I,g.ej(),4);if(I.L!=2){m=I.Y;if(!m||!g.gg()||typeof g.cS.BroadcastChannel==="undefined")return I.return();M=new rMK;return I.return(new O$(m,M))}e=g.qZ(I);e instanceof Error&&g.PD(e);return I.return()})},mQ=function(){R7s||(R7s=HPl());
return R7s},WVu=function(m){var M;
m=(M=m.options)==null?void 0:M.persistenceOption;return m==="ENTITY_PERSISTENCE_OPTION_PERSIST"||m==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},kb6=function(m){var M;
return g.p(function(e){return e.L==1?g.T(e,mQ(),2):(M=e.Y)?g.T(e,Ll(M,"readwrite",function(I){for(var t={},Y=g.P(m),b=Y.next(),r={};!b.done;r={pO:void 0,iy:void 0},b=Y.next())r.pO=b.value,r.pO.entityKey&&WVu(r.pO)&&(r.iy=g.i2(r.pO.payload),b=void 0,r.pO.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(b=function(q){return function(){return G2(I,q.pO.payload[q.iy],q.iy)}}(r)),r.pO.type==="ENTITY_MUTATION_TYPE_DELETE"&&(b=function(q){return function(){return ak(I,q.pO.entityKey)}}(r)),r.pO.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(b=function(q){return function(){return bP9(I,q.pO.entityKey,q.pO.payload[q.iy],q.iy)}}(r)),b&&(t[r.pO.entityKey]=t[r.pO.entityKey]?t[r.pO.entityKey].then(b):b()));
return g.iR.all(Object.values(t))}),0):e.return()})},Uyl=function(m){var M;
return g.p(function(e){if(e.L==1){M=m.mutations;if(!M||M.length<=0)return e.return();if(g.WG){var I={type:"ENTITY_LOADED"};M!==void 0&&(I.payload=M);g.WG.dispatch(I)}return g.T(e,kb6(M),2)}M.length=0;g.Yd(e)})},VU9=function(m){return m!==void 0},NNC=function(m){var M=g.$o();
M=Object.assign({},M);m=Object.assign({},m);for(var e in M)m[e]?(M[e]!==4&&(M[e]=m[e]),delete m[e]):M[e]!==2&&(M[e]=4);Object.assign(M,m);g.UNt(M);JSON.stringify(M);return M},cMK=function(m){var M,e;
return g.p(function(I){if(I.L==1)return g.T(I,g.ej(),2);if(I.L!=3)return(M=I.Y)?g.T(I,g.dR(M),3):I.return();e=I.Y;return I.return(g.Bo(e,["index","media","captions"],{mode:"readwrite",uS:!0},function(t){var Y=IDBKeyRange.bound(m+"|",m+"~");t=[t.objectStore("index").delete(Y),t.objectStore("media").delete(Y),t.objectStore("captions").delete(Y)];return g.iR.all(t).then(function(){})}))})},jA9=function(){var m,M;
return g.p(function(e){if(e.L==1)return g.T(e,g.ej(),2);if(e.L!=3){m=e.Y;if(!m)throw g.co("rvdfd");return g.T(e,g.dR(m),3)}M=e.Y;return e.return(g.Bo(M,["index","media"],{mode:"readwrite",uS:!0},function(I){var t={};return g.TX(I.objectStore("index"),{},function(Y){var b=Y.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),r=g.iR.resolve(void 0);if(b){var q=b[1];b=b[2];t[q]=t[q]||{};var Z;t[q][b]=g.i8$((Z=Y.getValue())==null?void 0:Z.fmts)}else r=Y.delete().then(function(){});
return g.iR.all([g.Xg(Y),r]).then(function(F){return g.P(F).next().value})}).then(function(){for(var Y={},b=g.P(Object.keys(t)),r=b.next();!r.done;r=b.next()){r=r.value;
var q=t[r].v;Y[r]=t[r].a&&q?1:2}var Z=NNC(Y);return g.Iud(I.objectStore("media"),{},function(F){var C=F.cursor.key.match(g.uR8);C&&Y[C[1]]||I.objectStore("media").delete(F.cursor.key);return g.dMO(F)}).then(function(){return Z})})}))})},iP9=function(m,M){var e,I;
return g.p(function(t){if(t.L==1)return g.T(t,g.ej(),2);if(t.L!=3){e=t.Y;if(!e)throw g.co("wct");return g.T(t,g.dR(e),3)}I=t.Y;return g.T(t,g.Bo(I,["captions"],{mode:"readwrite",uS:!0},function(Y){var b=[];Y=Y.objectStore("captions");for(var r=0;r<M.length;r++){var q=g.hu(Y,M[r],m+"|"+M[r].metadata.vss_id);b.push(q)}return g.iR.all(b)}),0)})},yM9=function(m){var M,e,I;
return g.p(function(t){if(t.L==1)return M=IDBKeyRange.bound(m+"|",m+"~"),g.T(t,g.ej(),2);if(t.L!=3){e=t.Y;if(!e)throw g.co("gactfv");return g.T(t,g.dR(e),3)}I=t.Y;return t.return(I.getAll("captions",M))})},JMd=function(m){return g.p(function(M){g.ac(m,0);
return M.return(cMK(m))})},fHl=function(m){return{context:g.mF(),
videoIds:m}},uvT=function(m){return{context:g.mF(),
playlistIds:m}},SOd=function(m){return{context:g.mF(),
offlinePlaylistSyncChecks:m}},EMT=function(){this.L=new Map},Poy=function(){nMC||(nMC=new EMT);
return nMC},BNl=function(m,M){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:m},metadata:M,statusCode:void 0,csn:void 0,can:void 0}},h7d=function(m,M,e){if(!e){var I=I===void 0?!1:I;
e=m.L.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!e||I)e=g.ki(16),m.L.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",e)}m={flowNonce:e,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:M.eventType};M.metadata&&(m.flowMetadata=M.metadata);M.statusCode!==void 0&&(m.flowEventStatus=M.statusCode);M.csn&&(m.csn=M.csn);M.can&&(m.can=M.can);g.kr("flowEvent",m,void 0)},wIK=function(m){var M,e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8;
return g.p(function(n6){if(n6.L==1)return g.T(n6,Ll(m,{mode:"readonly",uS:!0},function(J){return DQ(J,"playbackData").then(function(ms){var jM=ms.map(function(KO){return KO.transfer}).filter(function(KO){return!!KO}),rw=ms.map(function(KO){return KO.offlineVideoPolicy}).filter(function(KO){return!!KO}),dw=ms.filter(function(KO){return!!KO.key}).map(function(KO){return g.db(g.aK(KO.key).entityId,"downloadStatusEntity")});
jM=DQ(J,"transfer",jM);rw=DQ(J,"offlineVideoPolicy",rw);dw=DQ(J,"downloadStatusEntity",dw);var q9=jM.then(function(KO){KO=KO.reduce(function(es,u2){(u2==null?0:u2.offlineVideoStreams)&&es.push.apply(es,g.h(u2.offlineVideoStreams));return es},[]).filter(function(es){return!!es});
return DQ(J,"offlineVideoStreams",KO)});
return g.iR.all([jM,rw,q9,dw]).then(function(KO){var es=g.P(KO);KO=es.next().value;var u2=es.next().value;var u=es.next().value;es=es.next().value;return[ms,KO,u2,u,es]})})}),2);
if(n6.L!=3)return M=n6.Y,g.T(n6,Ll(m,{mode:"readonly",uS:!0},function(J){return DQ(J,"mainDownloadsListEntity").then(function(ms){var jM,rw;return(rw=(jM=ms[0])==null?void 0:jM.downloads)!=null?rw:[]})}),3);
e=n6.Y;I=g.P(M);t=I.next().value;Y=I.next().value;b=I.next().value;r=I.next().value;q=I.next().value;Z=t;F=Y;C=b;R=r;H=q;W={};N={};y={};n={};E={};B=[];w=g.P(F);for(x=w.next();!x.done;x=w.next())(l=x.value)&&(W[l.key]=l);Mw=g.P(C);for(e$=Mw.next();!e$.done;e$=Mw.next())(Id=e$.value)&&(N[Id.key]=Id);bW=g.P(H);for(CO=bW.next();!CO.done;CO=bW.next())(tm=CO.value)&&(y[tm.key]=tm);j$=g.P(R);for(g8=j$.next();!g8.done;g8=j$.next())(Q0=g8.value)&&(n[Q0.key]=Q0);lW=g.P(e);for(LO=lW.next();!LO.done;LO=lW.next())zK=
LO.value,L6=void 0,E[(L6=zK.videoItem)!=null?L6:""]=!0,zK.videoItem&&(S=BS=void 0,K6=(S=(BS=g.aK(zK.videoItem))==null?void 0:BS.entityId)!=null?S:"",B.push({externalVideoId:K6}));Ag=Z.filter(function(J){if(!J||!J.key||!J.offlineVideoPolicy)return!1;J=g.aK(J.key).entityId;J=g.db(J,"downloadStatusEntity");var ms;return!(J&&((ms=y[J])==null?void 0:ms.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
r8=Ag.map(function(J){var ms=W[J.transfer],jM=[];if(ms==null?0:ms.offlineVideoStreams)for(var rw=g.P(ms.offlineVideoStreams),dw=rw.next();!dw.done;dw=rw.next())(dw=n[dw.value])&&jM.push(dw);rw=N[J.offlineVideoPolicy];dw=E;var q9=J==null?void 0:J.playerResponseTimestamp,KO=g.aK(rw.key).entityId;J=g.db(KO,"mainVideoEntity");if(rw.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var es="OFFLINE_VIDEO_STATE_DISABLED";rw.expirationTimestamp&&Number(rw.expirationTimestamp)<Date.now()/1E3&&(es="OFFLINE_VIDEO_STATE_EXPIRED")}else if(rw.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")es="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(ms==null?void 0:ms.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":es="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":es="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":es="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":es="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":es="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":es="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:es="OFFLINE_VIDEO_STATE_UNKNOWN"}if(es==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(ms==null?void 0:ms.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":es="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":es="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":es=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}KO={id:KO,videoState:es};if(ms==null?0:ms.cotn)KO.cotn=ms.cotn;if(ms==null?0:ms.maximumDownloadQuality)KO.selectedVideoQuality=ms==null?void 0:ms.maximumDownloadQuality;if(ms==null?0:ms.lastProgressTimeMs)KO.lastProgressTimeMs=ms.lastProgressTimeMs;q9&&(KO.playerResponseSavedTimeMs=String(Number(q9)*1E3));ms=String;q9=0;jM=g.P(jM);for(es=jM.next();!es.done;es=jM.next())if(es=es.value,es.streamsProgress){es=g.P(es.streamsProgress);for(var u2=es.next();!u2.done;u2=
es.next()){var u=void 0;q9+=Number((u=u2.value.numBytesDownloaded)!=null?u:0)}}KO.downloadedBytes=ms(q9);KO.selectedOfflineMode=dw[J]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";rw.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(KO.offlinePlaybackDisabledReason=rw.offlinePlaybackDisabledReason);return KO});
return n6.return({offlineVideos:r8,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:B}}})})},oMy=function(){this.locks=navigator.locks},z7s=function(){try{var m=g.f6("ytglobal.locks_");
if(m)return m;var M;if(M=navigator){var e=navigator;M="locks"in e&&!!e.locks}if(M)return g.cS.localStorage&&g.cS.localStorage.getItem("noop"),m=new oMy,g.js("ytglobal.locks_",m),m}catch(I){}},M4=function(){},TNT=function(){},XIS=function(m){if(m.includes(":"))throw Error("Invalid user cache name: "+m);
return m+":"+g.vW("CacheStorage get")},pId=function(){return g.p(function(m){if(eE!==void 0)return m.return(eE);
eE=new Promise(function(M){var e;return g.p(function(I){switch(I.L){case 1:return g.bf(I,2),g.T(I,Im.open("test-only"),4);case 4:return g.T(I,Im.delete("test-only"),5);case 5:g.ru(I,3);break;case 2:if(e=g.qZ(I),e instanceof Error&&e.name==="SecurityError")return M(!1),I.return();case 3:M("caches"in window),g.Yd(I)}})});
return m.return(eE)})},xyT=function(){return g.p(function(m){if(m.L==1)return g.T(m,pId(),2);
if(!m.Y)return m.return(void 0);lHy||(lHy=new TNT);return m.return(lHy)})},tD=function(m,M,e){g.hy(new g.fO("Woffle: "+m,e?{cotn:e}:""));
M instanceof Error&&g.hy(M)},AMf=function(m){var M;
return g.p(function(e){if(e.L==1)return g.T(e,wIK(m),2);M=e.Y;g.kr("offlineStateSnapshot",M);g.Yd(e)})},Y4=function(m){g.A.call(this);
var M=this;this.api=m;this.ZL={xxw:function(){return M.L},
E0C:function(){return M.Y}};
typeof g.cS.BroadcastChannel!=="undefined"&&(this.L=new g.cS.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.vW()),this.L.onmessage=this.D.bind(this),this.Y=new g.cS.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.vW()),this.Y.onmessage=this.B.bind(this))},bk=function(m,M){m.api.FC("onOfflineOperationFailure",M);
var e;(e=m.L)==null||e.postMessage(M)},Dyg=function(m,M,e){var I=this;
this.S=m;this.nE=M;this.visibility=e;this.C=this.T=this.X=this.D=this.L=!1;this.B=new g.vR(function(){I.zC()});
this.ZL={sS:function(){return I.Y},
zC:function(){I.zC()},
K$w:function(){return I.B}};
this.visibility.subscribe("visibilitystatechange",function(){I.Au()})},$y9=function(m){if(!m.D&&!m.L){var M=z7s();
if(M){m.D=!0;var e=g.vW("OfflineLockManager");M.request("woffle_orchestration_leader:"+e,{},function(){var I,t;return g.p(function(Y){switch(Y.L){case 1:return g.bf(Y,2),m.Y=new g.FU,m.L=!0,m.D=!1,g.T(Y,m.S(),4);case 4:return g.T(Y,m.Y.promise,5);case 5:g.ru(Y,0);break;case 2:I=g.qZ(Y),m.zC(),I instanceof Error&&(t=I,t.args=[{name:"WoLockManagerError",NT:I.name}],g.PD(t)),g.Yd(Y)}})})}}},Gbg=function(m){m.L&&(m.C=!0,QV(m))},aHs=function(m,M){m.L&&(m.X=M,QV(m))},dyZ=function(m,M){m.L&&(m.T=M,QV(m))},
QV=function(m){m.T&&m.X&&m.C&&m.visibility.isBackground()?g.gi(m.B,6E4):m.B.stop()},sy=function(m){var M;
m.offlineDeleteReason=(M=m.offlineDeleteReason)!=null?M:"OFFLINE_DELETE_REASON_UNKNOWN";var e;m.offlineModeType=(e=m.offlineModeType)!=null?e:"OFFLINE_NOW";g.kr("offlineDeleteEvent",m)},rp=function(m,M){var e=M.videoId;
var I=M.pZ;M=M.offlineModeType;m.encryptedVideoId=e;m.cotn=I==null?void 0:I.cotn;m.offlineabilityFormatType=I==null?void 0:I.maximumDownloadQuality;var t;m.isRefresh=(t=I==null?void 0:I.isRefresh)!=null?t:!1;var Y;m.softErrorCount=(Y=I==null?void 0:I.transferRetryCount)!=null?Y:0;m.offlineModeType=M!=null?M:"OFFLINE_NOW";(m.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&m.statusType==="UNKNOWN_STATUS_TYPE"||!m.transferStatusType&&!m.statusType)&&g.hy(Error("Woffle unknown transfer status"));
g.kr("offlineTransferStatusChanged",m)},OPd=function(m){rp({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},m)},LVy=function(m,M,e,I){I={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!I};M&&e&&(M=Math.floor(M/1024).toFixed(),e=Math.floor(e/1024).toFixed(),I.alreadyDownloadedKbytes=M,I.totalFetchedKbytes=M,I.totalContentKbytes=e);rp(I,m)},vM9=function(m){rp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},m)},gMf=function(m){rp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},m)},KV0=function(m){switch(m){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
q4=function(m){var M,e,I;
return((I=(M=m.actionMetadata)==null?void 0:(e=M.retryScheduleIntervalsInSeconds)==null?void 0:e.length)!=null?I:0)>0},ZJ=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!m.entityKey},FK=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!m.entityKey},Cj=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!m.entityKey},mUC=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!m.entityKey},
H6=function(m,M,e,I,t){t=t===void 0?!1:t;
var Y,b,r,q,Z,F;return g.p(function(C){if(C.L==1)return Y=g.db(m,M),b=g.db(m,"downloadStatusEntity"),g.T(C,Ll(e,{mode:"readonly",uS:!0},function(R){return g.iR.all([A3(R,Y,M),A3(R,b,"downloadStatusEntity")])}),2);
r=C.Y;q=r.length?r[0]:void 0;if(!q)return C.k7(0);Z=Mny;if(F=r.length>1?r[1]:void 0){if(F.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!t)return C.return();F.downloadState=I}else F={key:b,downloadState:I};g.Xf(q,Z,F);return g.T(C,Ll(e,{mode:"readwrite",uS:!0},function(R){return g.iR.all([G2(R,q,M),G2(R,F,"downloadStatusEntity")])}),0)})},Rm=function(m,M){return m.actionType===M.actionType&&m.entityKey===M.entityKey},W6=function(m,M){if(m&&m.transferState!=="TRANSFER_STATE_COMPLETE"&&m.transferState!==
"TRANSFER_STATE_FAILED"){var e=g.aK(m.key).entityId;
rp({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:e,pZ:m,offlineModeType:M})}},k4=function(m){if(!m||!m.thumbnails)return[];
var M=[];m=g.P(m.thumbnails);for(var e=m.next();!e.done;e=m.next())e=e.value,e.url&&M.push(e.url);return M},ed9=function(m,M,e){e=e===void 0?[]:e;
var I,t,Y,b,r,q,Z,F,C,R,H,W,N;return g.p(function(y){if(y.L==1)return e.length?g.T(y,Kl(m,M),2):y.return([]);I=y.Y;t=new Set;Y=g.P(I);for(b=Y.next();!b.done;b=Y.next())if(r=b.value,q=r.id||r.key)Z=g.aK(q).entityId,t.add(Z);F=[];C=g.P(e);for(R=C.next();!R.done;R=C.next())H=R.value,W=H.offlineVideoData,N=void 0,((N=W)==null?0:N.videoId)&&!t.has(W.videoId)&&F.push(H);return y.return(F)})},IT6=function(m,M,e){return new g.b$(m,{cotn:M,
raw_player_response:e,download_media:!0,start:Infinity,disable_watch_next:!0})},tnu=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Uy=function(m,M,e,I,t,Y,b,r,q,Z,F){this.entityType=m;
this.actionId=M;this.action=e;this.parentActionId=I;this.rootActionId=t===void 0?M:t;this.childActionIds=Y;this.prereqActionId=b;this.postreqActionIds=r;this.hasChildActionFailed=Z;this.retryScheduleIndex=0;this.L=F||Date.now();this.retryScheduleIndex=q||0},VV=function(m){if(!m.key)throw Error("Entity key is required.");
if(!m.actionProto)throw Error("OfflineOrchestrationAction is required.");var M=g.aK(m.key),e=g.aK(m.actionProto.entityKey);return new Uy(e.entityType,M.entityId,m.actionProto,m.parentActionId,m.rootActionId,m.childActionIds,m.prereqActionId,m.postreqActionIds,m.retryScheduleIndex,m.hasChildActionFailed,Number(m.enqueueTimeSec)*1E3)},N4=function(m){return{key:g.db(m.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:m.action,parentActionId:m.parentActionId,rootActionId:m.rootActionId,childActionIds:m.childActionIds,prereqActionId:m.prereqActionId,postreqActionIds:m.postreqActionIds,retryScheduleIndex:m.retryScheduleIndex,hasChildActionFailed:m.hasChildActionFailed,enqueueTimeSec:(m.L/1E3).toFixed()}},YTs=function(){var m;
return g.p(function(M){return M.L==1?g.T(M,xyT(),2):(m=M.Y)?M.return(m.delete("yt-player-local-img")):M.return(!0)})},c6=function(m){var M,e;
return g.p(function(I){if(I.L==1)return g.T(I,xyT(),2);if(I.L!=3){M=I.Y;if(!M)throw Error("Cache API not supported");return m.length?g.T(I,M.open("yt-player-local-img"),3):I.return()}e=I.Y;return g.T(I,Promise.all(m.map(function(t){return e.delete(t)})),0)})},jE=function(m){var M,e;
return g.p(function(I){if(I.L==1)return g.T(I,xyT(),2);if(I.L!=3){M=I.Y;if(!M)throw Error("Cache API not supported");return m.length?g.T(I,M.open("yt-player-local-img"),3):I.return()}e=I.Y;return g.T(I,e.addAll(m),0)})},ik=function(m,M,e,I,t){var Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6;
return g.p(function(BS){switch(BS.L){case 1:return Y=g.db(m,"mainVideoEntity"),b=g.db(m,"ytMainChannelEntity"),r=g.db(m,"transfer"),q=g.db(m,"videoDownloadContextEntity"),g.T(BS,Ll(M,{mode:"readonly",uS:!0},function(S){return g.iR.all([A3(S,Y,"mainVideoEntity"),A3(S,b,"ytMainChannelEntity"),A3(S,r,"transfer"),A3(S,q,"videoDownloadContextEntity"),DQ(S,"ytMainChannelEntity"),DQ(S,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=BS.Y;F=g.P(Z);C=F.next().value;R=F.next().value;H=F.next().value;W=F.next().value;N=F.next().value;y=F.next().value;n=C;E=R;B=H;w=W;x=N;l=y;if(!n&&!E){BS.k7(3);break}Mw=n?k4(n.thumbnail):[];if(!E){e$=[];BS.k7(4);break}return g.T(BS,boy(E,x),5);case 5:e$=BS.Y;case 4:return Id=e$,g.T(BS,c6(Mw.concat(Id)),3);case 3:bW=[];CO=g.db(m,"downloadStatusEntity");tm=g.P(l);for(j$=tm.next();!j$.done;j$=tm.next())g8=j$.value,Q0=g.aK(g8.key).entityId,lW=VV(g8),LO=g.aK(lW.action.entityKey).entityId,Q0!==
m&&LO!==m||Rm(e,g8.actionProto)||bW.push(g8.key);return g.T(BS,Ll(M,{mode:"readwrite",uS:!0},function(S){var K6=bW.map(function(Ag){return ak(S,Ag)});
K6.push(ak(S,Y,{MA:!0}));K6.push(ak(S,CO,{MA:!0}));return g.iR.all(K6)}),7);
case 7:L6=(zK=w)==null?void 0:zK.offlineModeType,t&&(sy(t),t.offlineModeType&&(L6=t.offlineModeType)),W6(B,L6),bk(I,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Yd(BS)}})},rou=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8,n6,J,ms,jM,rw,dw,q9,KO,es,u2,u,c,f;
return g.p(function(z){switch(z.L){case 1:return t=g.db(m,"mainPlaylistEntity"),Y=g.db(m,"ytMainChannelEntity"),g.T(z,Ll(M,{mode:"readonly",uS:!0},function(d){return g.iR.all([A3(d,t,"mainPlaylistEntity"),A3(d,Y,"ytMainChannelEntity"),DQ(d,"mainPlaylistEntity"),DQ(d,"mainDownloadsListEntity"),DQ(d,"ytMainChannelEntity"),DQ(d,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=z.Y;r=g.P(b);q=r.next().value;Z=r.next().value;F=r.next().value;C=r.next().value;R=r.next().value;H=r.next().value;W=q;N=Z;y=F;n=C;E=R;B=H;if(!W&&!N){z.k7(3);break}w=W?QwZ(W):[];if(!N){x=[];z.k7(4);break}return g.T(z,boy(N,E),5);case 5:x=z.Y;case 4:return l=x,g.T(z,c6(w.concat(l)),3);case 3:Mw=[];e$=new Map;if(!W){z.k7(7);break}return g.T(z,swZ(W,y,n),8);case 8:Mw=z.Y;Id=g.P(Mw);for(bW=Id.next();!bW.done;bW=Id.next())CO=bW.value,e$.set(CO,{videoId:CO,playlistId:m,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.T(z,Ll(M,{mode:"readonly",uS:!0},function(d){return g.iR.all([DQ(d,"transfer"),DQ(d,"videoDownloadContextEntity")])}),9);
case 9:tm=z.Y;j$=g.P(tm);g8=j$.next().value;Q0=j$.next().value;lW=g8;LO=Q0;zK=g.P(lW);for(L6=zK.next();!L6.done;L6=zK.next())BS=L6.value,S=g.aK(BS.key).entityId,(K6=e$.get(S))&&BS&&(K6.cotn=BS.cotn);Ag=g.P(LO);for(r8=Ag.next();!r8.done;r8=Ag.next())n6=r8.value,J=g.aK(n6.key).entityId,(ms=e$.get(J))&&n6&&(ms.offlineModeType=n6.offlineModeType);case 7:jM=[];rw=g.P(B);for(dw=rw.next();!dw.done;dw=rw.next())q9=dw.value,KO=g.aK(q9.key).entityId,es=VV(q9),KO!==m&&es.rootActionId!==m||Rm(e,q9.actionProto)||
jM.push(q9.key);u2=g.db(m,"mainPlaylistEntity");return g.T(z,Ll(M,{mode:"readwrite",uS:!0},function(d){var s7=jM.map(function(L){return ak(d,L)});
s7.push(ak(d,u2,{MA:!0}));return g.iR.all(s7)}),10);
case 10:if(!W){z.k7(0);break}Mw.reverse();if(!Mw){z.k7(0);break}u=g.P(Mw);c=u.next();case 13:if(c.done){z.k7(0);break}f=c.value;return g.T(z,ik(f,M,e,I,e$.get(f)),14);case 14:c=u.next(),z.k7(13)}})},Zoy=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R;
return g.p(function(H){if(H.L==1)return t=g.db("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),Y=new Map,g.T(H,Ll(m,{mode:"readwrite",uS:!0},function(W){var N=DQ(W,"transfer"),y=DQ(W,"offlineOrchestrationActionWrapperEntity"),n=DQ(W,"videoDownloadContextEntity"),E=A3(W,t,"mainDownloadsListEntity");return g.iR.all([N,y,n,E]).then(function(B){B=g.P(B);var w=B.next().value;var x=B.next().value;var l=B.next().value;var Mw=B.next().value;B=qT9.map(function(Id){return YOf(W,Id)});
x=g.P(x);for(var e$=x.next();!e$.done;e$=x.next())e$=e$.value,Rm(M,e$.actionProto)||B.push(ak(W,e$.key,{MA:!0}));Mw&&(Mw.downloads=[],B.push(G2(W,Mw,"mainDownloadsListEntity")));if(l)for(l=g.P(l),Mw=l.next();!Mw.done;Mw=l.next())Mw=Mw.value,x=g.aK(Mw.key).entityId,x=g.db(x,"transfer"),Y.set(x,Mw.offlineModeType);return g.iR.all(B).then(function(){return w})})}),2);
b=H.Y;r=g.P(b);for(q=r.next();!q.done;q=r.next())Z=q.value,W6(Z,Y.get(Z.key)),F=g.aK(Z.key).entityId,C={videoId:F,offlineDeleteReason:I,cotn:Z.cotn,offlineModeType:Y.get(Z.key)},sy(C),R=g.db(F,"mainVideoEntity"),bk(e,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.T(H,YTs(),0)})},QwZ=function(m,M){var e=[];
if(m.thumbnailStyleData){m=g.P(m.thumbnailStyleData);for(var I=m.next();!I.done;I=m.next()){var t=void 0,Y=void 0,b=void 0;e=e.concat(k4((t=I.value)==null?void 0:(Y=t.value)==null?void 0:(b=Y.collageThumbnail)==null?void 0:b.coverThumbnail))}}M=k4(M);return e.concat(M)},swZ=function(m,M,e){var I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id;
return g.p(function(bW){I=[];t=new Set;if(e.length)for(Y=g.P(e),b=Y.next();!b.done;b=Y.next())if(r=b.value,q=void 0,(q=r.downloads)==null?0:q.length)for(Z=g.P(r.downloads),F=Z.next();!F.done;F=Z.next())C=F.value,C.videoItem&&(R=g.aK(C.videoItem).entityId,t.add(R));if(m.videos){H=g.P(m.videos);for(W=H.next();!W.done;W=H.next())N=W.value,y=JSON.parse(g.aK(N).entityId),y.videoId&&!t.has(y.videoId)&&I.push(y.videoId);n=g.P(M);for(E=n.next();!E.done;E=n.next())if(B=E.value,B.key!==m.key&&(w=B.videos))for(x=
g.P(w),l=x.next();!l.done;l=x.next())Mw=l.value,e$=JSON.parse(g.aK(Mw).entityId),e$.videoId&&(Id=I.indexOf(e$.videoId),Id!==-1&&I.splice(Id,1))}return bW.return(I)})},boy=function(m,M){var e,I,t,Y,b,r,q,Z;
return g.p(function(F){e=k4(m.avatar);I=g.P(M);for(t=I.next();!t.done;t=I.next())if(Y=t.value,Y.id!==m.id)for(b=g.P(k4(Y.avatar)),r=b.next();!r.done;r=b.next())q=r.value,Z=e.indexOf(q),Z!==-1&&e.splice(Z,1);return F.return(e)})},FNf=function(m){var M;
return g.p(function(e){M=g.U(m.frameworkUpdates,yV);return m.frameworkUpdates&&M?g.T(e,Uyl(M),0):e.return()})},Ho9=function(m){var M;
if((M=m.onResponseReceivedActions)!=null&&M.length){var e;m=(e=g.U(g.U(m.onResponseReceivedActions[0],C1S),g.kll))==null?void 0:e.actions;if(m!=null&&m.length)return m}},Rdl=function(m){var M,e,I;
return g.p(function(t){if(t.L==1)return m?g.T(t,gC(m,g.o4,"mainDownloadsListEntity"),2):t.return([]);M=t.Y;return((e=M)==null?0:(I=e.downloads)==null?0:I.length)?t.return(M.downloads.map(function(Y){var b;return(b=Y.videoItem)!=null?b:""})):t.return([])})},krS=function(m,M){var e;
return g.p(function(I){return I.L==1?g.T(I,WNs(m,M),2):(e=I.Y)?g.T(I,Ll(m,{mode:"readwrite",uS:!0},function(t){var Y=[G2(t,e.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];e.mainDownloadsListEntity&&Y.push(G2(t,e.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.iR.all(Y)}),0):I.k7(0)})},WNs=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B;
return g.p(function(w){if(w.L==1)return e=g.db("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.db("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.T(w,Ll(m,{mode:"readonly",uS:!0},function(x){return g.iR.all([A3(x,e,"mainDownloadsLibraryEntity"),A3(x,I,"mainDownloadsListEntity")])}),2);
t=w.Y;Y=g.P(t);b=Y.next().value;r=Y.next().value;q=b;Z=r;q||(q={id:e});F=g.P(M);for(C=F.next();!C.done;C=F.next())if(R=C.value,R===g.o4){if(q.smartDownloadsList)return w.return();q.smartDownloadsList=R}else if(H=g.aK(R).entityType,W={},H==="mainPlaylistEntity"?W.playlistItem=R:H==="mainVideoEntity"&&(W.videoItem=R),!g.n5(W)){N=void 0;if((N=Z)==null?0:N.downloads){y=!1;n=g.P(Z.downloads);for(E=n.next();!E.done;E=n.next())if(B=E.value,B.playlistItem===R||B.videoItem===R){y=!0;break}y||Z.downloads.push(W)}else Z=
{id:I,downloads:[W]};q.downloadsList=I}return w.return({mainDownloadsLibraryEntity:q,mainDownloadsListEntity:Z})})},UUl=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y;
return g.p(function(n){if(n.L==1)return e=g.db("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.db("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.T(n,Ll(m,{mode:"readonly",uS:!0},function(E){return g.iR.all([A3(E,e,"mainDownloadsLibraryEntity"),A3(E,I,"mainDownloadsListEntity"),A3(E,g.o4,"mainDownloadsListEntity")])}),2);
t=n.Y;Y=g.P(t);b=Y.next().value;r=Y.next().value;q=Y.next().value;Z=b;F=r;C=q;if(!Z)return n.k7(0);if(M===g.o4&&((R=C)==null?0:R.downloads))C.downloads=[];else if((H=F)==null?0:H.downloads)for(W=g.aK(M).entityType,N=0;N<F.downloads.length;N++)if(y=F.downloads[N],W==="mainVideoEntity"&&y.videoItem===M){F.downloads.splice(N,1);break}else if(W==="mainPlaylistEntity"&&y.playlistItem===M){F.downloads.splice(N,1);break}return g.T(n,Ll(m,{mode:"readwrite",uS:!0},function(E){var B=[G2(E,Z,"mainDownloadsLibraryEntity")];
F&&B.push(G2(E,F,"mainDownloadsListEntity"));C&&B.push(G2(E,C,"mainDownloadsListEntity"));return g.iR.all(B)}),0)})},JD=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R;
return g.p(function(H){if(H.L==1)return e=g.db(M,"transfer"),I=g.db(M,"videoDownloadContextEntity"),g.T(H,Ll(m,{mode:"readonly",uS:!0},function(W){return g.iR.all([A3(W,e,"transfer"),A3(W,I,"videoDownloadContextEntity")])}),2);
t=H.Y;Y=g.P(t);b=Y.next().value;r=Y.next().value;q=b;Z=r;R={videoId:M,cotn:(F=q)==null?void 0:F.cotn,offlineModeType:(C=Z)==null?void 0:C.offlineModeType};return H.return(R)})},fj=function(m,M,e,I,t){var Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$;
return g.p(function(Id){switch(Id.L){case 1:return Y=g.db(m,"musicTrack"),b=g.db(m,"transfer"),g.T(Id,Ll(M,{mode:"readonly",uS:!0},function(bW){return g.iR.all([A3(bW,Y,"musicTrack"),A3(bW,b,"transfer"),DQ(bW,"musicTrack"),DQ(bW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=Id.Y;q=g.P(r);Z=q.next().value;F=q.next().value;C=q.next().value;R=q.next().value;H=Z;W=F;N=C;y=R;if(!H){Id.k7(3);break}return g.T(Id,VnZ(H,N),4);case 4:return n=Id.Y,g.T(Id,c6(n),3);case 3:E=[];B=g.P(y);for(w=B.next();!w.done;w=B.next())x=w.value,l=g.aK(x.key).entityId,Mw=VV(x),e$=g.aK(Mw.action.entityKey).entityId,l!==m&&e$!==m||Rm(e,x.actionProto)||E.push(x.key);return g.T(Id,Ll(M,{mode:"readwrite",uS:!0},function(bW){var CO=E.map(function(tm){return ak(bW,tm)});
CO.push(ak(bW,Y,{MA:!0}));return g.iR.all(CO)}),6);
case 6:W6(W),t&&sy(t),bk(I,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Yd(Id)}})},uk=function(m,M,e,I,t){var Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8;
return g.p(function(n6){switch(n6.L){case 1:return Y=g.db(m,M),b=g.db("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(n6,Ll(e,{mode:"readonly",uS:!0},function(J){return g.iR.all([A3(J,Y,M),A3(J,b,"musicDownloadsLibraryEntity"),DQ(J,M),DQ(J,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=n6.Y;q=g.P(r);Z=q.next().value;F=q.next().value;C=q.next().value;R=q.next().value;H=Z;W=F;N=C;y=R;if(!H){n6.k7(3);break}return g.T(n6,VnZ(H,N),4);case 4:return n=n6.Y,g.T(n6,c6(n),3);case 3:E=[];B=new Map;if(!H){n6.k7(6);break}return g.T(n6,NPd(H,N,W),7);case 7:E=n6.Y;w=g.P(E);for(x=w.next();!x.done;x=w.next())l=x.value,Mw=g.aK(l).entityId,B.set(Mw,{videoId:Mw,playlistId:m,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.T(n6,Kl(e,"transfer"),8);case 8:for(e$=n6.Y,
Id=g.P(e$),bW=Id.next();!bW.done;bW=Id.next())CO=bW.value,tm=g.aK(CO.key).entityId,(j$=B.get(tm))&&CO&&(j$.cotn=CO.cotn);case 6:g8=[];Q0=g.P(y);for(lW=Q0.next();!lW.done;lW=Q0.next())LO=lW.value,zK=g.aK(LO.key).entityId,L6=VV(LO),zK!==m&&L6.rootActionId!==m||Rm(I,LO.actionProto)||g8.push(LO.key);BS=g.db(m,M);return g.T(n6,Ll(e,{mode:"readwrite",uS:!0},function(J){var ms=g8.map(function(jM){return ak(J,jM)});
ms.push(ak(J,BS,{MA:!0}));return g.iR.all(ms)}),9);
case 9:if(!H){n6.k7(0);break}E.reverse();if(!E.length){n6.k7(0);break}S=g.P(E);K6=S.next();case 12:if(K6.done){n6.k7(0);break}Ag=K6.value;r8=g.aK(Ag).entityId;if(!r8){n6.k7(13);break}return g.T(n6,fj(r8,e,I,t,B.get(r8)),13);case 13:K6=S.next(),n6.k7(12)}})},SE=function(m,M,e){var I,t,Y,b,r,q,Z;
return g.p(function(F){if(F.L==1)return g.T(F,Ll(m,{mode:"readwrite",uS:!0},function(C){var R=DQ(C,"transfer"),H=DQ(C,"offlineOrchestrationActionWrapperEntity");return g.iR.all([R,H]).then(function(W){W=g.P(W);var N=W.next().value;var y=W.next().value;W=coS.map(function(w){return YOf(C,w)});
y=g.P(y);for(var n=y.next();!n.done;n=y.next()){n=n.value;var E=g.aK(n.actionProto.entityKey).entityType==="musicTrack",B=n.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Rm(M,n.actionProto)||E&&(!E||B)||W.push(ak(C,n.key,{MA:!0}))}return g.iR.all(W).then(function(){return N})})}),2);
I=F.Y;t=g.P(I);for(Y=t.next();!Y.done;Y=t.next())b=Y.value,W6(b),r=g.aK(b.key).entityId,q={videoId:r,offlineDeleteReason:void 0,cotn:b.cotn},sy(q),Z=g.db(r,"musicTrack"),bk(e,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.T(F,YTs(),0)})},jw0=function(m){for(var M,e=g.P(m.additionalMetadatas),I=e.next();!I.done;I=e.next())I=I.value,I.offlineMusicVideoData&&(M=I.offlineMusicVideoData);
var t,Y,b,r,q;return{id:g.db(m.videoId,"musicTrack"),videoId:m.videoId,title:m.title,thumbnailDetails:m.thumbnail,lengthMs:String(Number(m.lengthSeconds)*1E3),albumTitle:(t=M)==null?void 0:t.releaseTitle,musicVideoType:(Y=M)==null?void 0:Y.musicVideoType,contentRating:{explicitType:(b=M)==null?void 0:b.explicitType},artistNames:((r=M)==null?void 0:r.byline)||((q=M)==null?void 0:q.channelName),downloadMetadata:g.db(m.videoId,"musicTrackDownloadMetadataEntity")}},NPd=function(m,M,e){var I,t,Y,b,r,q,
Z,F,C,R,H,W,N,y,n,E,B,w;
return g.p(function(x){I=[];t=new Set;if((Y=e)==null?0:(b=Y.downloadedTracks)==null?0:b.length)for(r=g.P(e.downloadedTracks),q=r.next();!q.done;q=r.next())Z=q.value,t.add(Z);if(m.tracks){F=g.P(m.tracks);for(C=F.next();!C.done;C=F.next())R=C.value,t.has(R)||I.push(R);H=g.P(M);for(W=H.next();!W.done;W=H.next())if(N=W.value,N.id!==m.id&&(y=N.tracks))for(n=g.P(y),E=n.next();!E.done;E=n.next())B=E.value,w=I.indexOf(B),w!==-1&&I.splice(w,1)}return x.return(I)})},VnZ=function(m,M){var e,I,t,Y,b,r,q,Z;
return g.p(function(F){e=k4(m.thumbnailDetails);I=g.P(M);for(t=I.next();!t.done;t=I.next())if(Y=t.value,Y.id!==m.id)for(b=g.P(k4(Y.thumbnailDetails)),r=b.next();!r.done;r=b.next())q=r.value,Z=e.indexOf(q),Z!==-1&&e.splice(Z,1);return F.return(e)})},ioT=function(m,M){var e,I,t,Y,b,r,q,Z,F;
return g.p(function(C){if(C.L==1)return e=g.db("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(C,gC(m,e,"musicDownloadsLibraryEntity"),2);(I=C.Y)||(I={id:e});t=g.aK(M).entityType;t==="musicTrack"?(Y=I.downloadedTracks)!=null&&Y.includes(M)||(I.downloadedTracks=((b=I.downloadedTracks)!=null?b:[]).concat(M)):t==="musicPlaylist"?(r=I.downloadedPlaylists)!=null&&r.includes(M)||(I.downloadedPlaylists=((q=I.downloadedPlaylists)!=null?q:[]).concat(M)):t!=="musicAlbumRelease"||(Z=I.downloadedAlbumReleases)!=
null&&Z.includes(M)||(I.downloadedAlbumReleases=((F=I.downloadedAlbumReleases)!=null?F:[]).concat(M));return g.T(C,vz(m,I,"musicDownloadsLibraryEntity"),0)})},yo6=function(m,M){var e,I,t,Y,b,r,q;
return g.p(function(Z){if(Z.L==1)return e=g.db("music_downloads_library_id","musicDownloadsLibraryEntity"),g.T(Z,gC(m,e,"musicDownloadsLibraryEntity"),2);I=Z.Y;if(!I)return Z.k7(0);t=g.aK(M).entityType;t==="musicTrack"?Y=I.downloadedTracks:t==="musicPlaylist"&&(Y=I.downloadedPlaylists);if((b=Y)==null?0:b.length)for(r=0;r<Y.length;r++)if(q=Y[r],q===M){Y.splice(r,1);break}return g.T(Z,vz(m,I,"musicDownloadsLibraryEntity"),0)})},JoK=function(m){var M=m.videos;
m=[];var e=[];if(M){M=g.P(M);for(var I=M.next();!I.done;I=M.next()){var t=I.value.offlineVideoData.videoId;I=g.db(t,"musicTrack");t=g.db(t,"musicTrackDownloadMetadataEntity");m.push(I);e.push(t)}}return{vW:m,VK:e}},Ey=function(m,M,e){M={track:jw0(M)};
e&&(M.playlistId=e);if(m=g.U(m.actionMetadata,fT6))M.maximumDownloadQuality=m.maximumDownloadQuality;return{musicTrackEntityActionMetadata:M}},STu=function(m){var M,e,I,t,Y,b,r,q;
return g.p(function(Z){switch(Z.L){case 1:return M=g.gr(),e=fHl(m),I=g.IN(u8l),g.bf(Z,2),Y={G5:!0},g.T(Z,g.pz(M,e,I,void 0,Y),4);case 4:t=Z.Y;g.ru(Z,3);break;case 2:b=g.qZ(Z);if(b instanceof g.OM)throw r="GetOffline network manager error: "+b.message,tD(r,b),Error(r);tD("GetOffline fetch request error",b);throw Error("GetOffline fetch request error");case 3:q=nj(t);if(!t)throw tD("Network request failed"),Error("Network request failed");if(q!==void 0)P6(q);else if(!t.videos||!t.videos.length)throw tD("No data"),
Error("No data");return Z.return(t.videos.map(function(F){return F.offlineVideoData}))}})},Ewl=function(m){var M,e,I,t,Y,b,r,q;
return g.p(function(Z){switch(Z.L){case 1:return M=g.gr(),e=uvT(m),I=g.IN(u8l),g.bf(Z,2),Y={G5:!0},g.T(Z,g.pz(M,e,I,void 0,Y),4);case 4:t=Z.Y;g.ru(Z,3);break;case 2:b=g.qZ(Z);if(b instanceof g.OM)throw r="GetOffline network manager error for playlist: "+b.message,tD(r,b),Error(r);tD("GetOffline fetch request error for playlist",b);throw Error("GetOffline fetch request error for playlist");case 3:q=nj(t);if(!t)throw tD("Network request failed for playlist"),Error("Network request failed for playlist");
if(q!==void 0)P6(q,"playlist");else if(!t.playlists||!t.playlists.length)throw tD("No data for playlist"),Error("No data for playlist");return Z.return(t.playlists.map(function(F){return F.offlinePlaylistData}))}})},P1f=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO;
return g.p(function(zK){switch(zK.L){case 1:return g.T(zK,mQ(),2);case 2:t=zK.Y;if(!t)return zK.return([]);Y=[];if((b=I)==null?0:b.length){Y=I;zK.k7(3);break}return g.T(zK,Kl(t,"mainPlaylistEntity"),4);case 4:Y=zK.Y;case 3:if(!Y.length)return zK.return([]);r=[];q=Date.now()/1E3;Z=g.P(Y);F=Z.next();case 5:if(F.done)return r.length?g.T(zK,nwu(r),10):zK.return([]);C=F.value;if(!C.downloadState){R=void 0;zK.k7(8);break}return g.T(zK,gC(t,C.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:R=
zK.Y;case 8:H=R;W=void 0;y=(N=(W=C)==null?void 0:W.entityMetadata)&&N.nextAutoRefreshIntervalSeconds?Number(N.nextAutoRefreshIntervalSeconds):NaN;n=Number.isNaN(y)?m:y;B=E=void 0;w=((E=H)==null?0:E.lastSyncedTimestampMillis)?Number((B=H)==null?void 0:B.lastSyncedTimestampMillis)/1E3:0;l=x=void 0;Mw=((x=H)==null?0:x.addedTimestampMillis)?Number((l=H)==null?void 0:l.addedTimestampMillis)/1E3:0;if(e||!N||w+n<=q){e$=[];Id=void 0;if((Id=C.videos)==null?0:Id.length)for(bW=g.P(C.videos),CO=bW.next();!CO.done;CO=
bW.next())tm=CO.value,j$=JSON.parse(g.aK(tm).entityId),j$.videoId&&e$.push(j$.videoId);g8="0";N&&(Q0=void 0,g8=String(Number((Q0=N.offlineLastModifiedTimestampSeconds)!=null?Q0:0).toFixed()));lW={playlistId:C.playlistId,videoIds:e$,offlineLastModifiedTimestamp:g8,autoSync:M,offlineDateAddedTimestamp:String(Mw.toFixed())};r.push(lW)}F=Z.next();zK.k7(5);break;case 10:return LO=zK.Y,zK.return(LO)}})},BP9=function(){var m,M,e,I,t;
return g.p(function(Y){if(Y.L==1)return g.T(Y,mQ(),2);if(Y.L!=3)return(m=Y.Y)?g.T(Y,Kl(m,"refresh"),3):Y.return(!1);M=Y.Y;if((e=M[0])==null||!e.refreshTime)return Y.return(!1);I=Number(M[0].refreshTime);t=Date.now()/1E3;return Y.return(isFinite(I)&&t>=I)})},w90=function(m,M){var e,I,t;
return g.p(function(Y){switch(Y.L){case 1:return g.bf(Y,2),g.T(Y,hdK(m,M),4);case 4:return I=Y.Y,g.T(Y,FNf(I),5);case 5:e=Ho9(I);g.ru(Y,3);break;case 2:t=g.qZ(Y),tD("getAndProcessSmartDownloadsResponse request or processing error",t);case 3:return Y.return(e)}})},ow0=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO;
return g.p(function(zK){switch(zK.L){case 1:return g.T(zK,mQ(),2);case 2:t=zK.Y;if(!t)return zK.return([]);Y=[];if((b=I)==null?0:b.length){Y=I;zK.k7(3);break}return g.T(zK,Kl(t,"musicPlaylist"),4);case 4:Y=zK.Y;case 3:if(!Y.length)return zK.return([]);r=[];q=Date.now()/1E3;Z=g.P(Y);F=Z.next();case 5:if(F.done)return r.length?g.T(zK,nwu(r),10):zK.return([]);C=F.value;R=void 0;W=(H=(R=C)==null?void 0:R.entityMetadata)&&H.nextAutoRefreshIntervalSeconds?Number(H.nextAutoRefreshIntervalSeconds):NaN;N=
Number.isNaN(W)?m:W;n=y=0;E="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!C.downloadMetadata){zK.k7(8);break}return g.T(zK,gC(t,C.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:B=zK.Y,x=w=void 0,y=Number((x=(w=B)==null?void 0:w.addedTimestampMillis)!=null?x:"0")/1E3,Mw=l=void 0,n=Number((Mw=(l=B)==null?void 0:l.lastModifiedTimestampMillis)!=null?Mw:"0")/1E3,Id=e$=void 0,E=(Id=(e$=B)==null?void 0:e$.syncState)!=null?Id:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:bW=void 0;if(e||E!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!H||Number((bW=H.lastSyncedTimestampSeconds)!=null?bW:0)+N<=q){CO=[];tm=void 0;if((tm=C.tracks)==null?0:tm.length)for(j$=g.P(C.tracks),g8=j$.next();!g8.done;g8=j$.next())Q0=g8.value,CO.push(g.aK(Q0).entityId);lW={playlistId:C.playlistId,videoIds:CO,offlineLastModifiedTimestamp:String(n.toFixed()),autoSync:M,offlineDateAddedTimestamp:String(y.toFixed())};r.push(lW)}F=Z.next();zK.k7(5);break;case 10:return LO=zK.Y,zK.return(LO)}})},hdK=function(m,M){var e,I,t,Y,b,r,q,Z,F,C;
return g.p(function(R){switch(R.L){case 1:return e=g.gr(),g.T(R,mQ(),2);case 2:I=R.Y;if(!I){R.k7(3);break}return g.T(R,wIK(I),4);case 4:t=R.Y;case 3:var H=t;Y={context:g.mF(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:m},offlineClientState:H,clientStateRequestData:{preferredFormatType:M}}}};b=g.IN(zds);g.bf(R,5);q={G5:!0};return g.T(R,g.pz(e,Y,b,void 0,q),7);case 7:r=R.Y;g.ru(R,6);break;case 5:Z=g.qZ(R);if(Z instanceof g.OM)throw F=
"DPS network manager error for smart downloads: "+Z.message,tD(F,Z),Error(F);tD("DPS fetch request error for smart downloads",Z);throw Error("DPS fetch request error for smart downloads");case 6:C=nj(r);if(r)C!==void 0&&P6(C,"smart downloads");else throw tD("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return R.return(r)}})},X9s=function(m,M){var e,I,t,Y,b,r,q,Z;
return g.p(function(F){switch(F.L){case 1:return e=g.gr(),I={context:g.mF(),videoPlaybackPositionEntities:m,lastSyncTimestampUsec:M},t=g.IN(TPs),g.bf(F,2),b={G5:!0},g.T(F,g.pz(e,I,t,void 0,b),4);case 4:Y=F.Y;g.ru(F,3);break;case 2:r=g.qZ(F);if(r instanceof g.OM)throw q="VPPS network manager error: "+r.message,tD(q,r),Error(q);tD("VPPS fetch request error",r);throw Error("VPPS fetch request error");case 3:Z=nj(Y);if(Y)Z!==void 0&&P6(Z,"position sync");else throw tD("Network request failed for position sync"),
Error("Network request failed for position sync");return F.return(Y)}})},lT0=function(m,M,e){var I,t,Y,b,r,q,Z,F;
return g.p(function(C){switch(C.L){case 1:I=g.gr();var R=e.refreshData,H=e.isEnqueuedForExpiredStreamUrlRefetch,W=e.zL,N=e.offlineSourceData,y=e.mediaCapabilities,n={entityKey:m};R&&(n.refreshData=R);H&&(n.isExpiredStreamUrlRefetch=H);W&&(n.downloadParameters=W);N&&(n.offlineSourceData=N);R={context:g.HY(M),signatureTimestamp:20429,videos:[n]};y&&(R.mediaCapabilities=y);t=R;Y=g.IN(p9f);g.bf(C,2);r={G5:!0};return g.T(C,g.pz(I,t,Y,void 0,r),4);case 4:b=C.Y;g.ru(C,3);break;case 2:q=g.qZ(C);if(q instanceof
g.OM)throw Z="GetPDE network manager error: "+q.message,tD(Z,q),Error(Z);tD("GetPDE fetch request error",q);throw Error("GetPDE fetch request error");case 3:F=nj(b);if(b)F!==void 0&&P6(F,"PDE");else throw tD("Network request failed for PDE"),Error("Network request failed for PDE");return C.return(b)}})},nj=function(m){var M;
return(M=m.errorMetadata)==null?void 0:M.status},P6=function(m,M){M=M?" for "+M:"";
if(m===0)throw m="Empty response body"+M,tD(m),Error(m);m="Response with error"+M;tD(m);throw Error(m);},nwu=function(m){var M,e,I,t,Y,b,r,q;
return g.p(function(Z){switch(Z.L){case 1:return M=g.gr(),e=SOd(m),I=g.IN(xU0),g.bf(Z,2),Y={G5:!0},g.T(Z,g.pz(M,e,I,void 0,Y),4);case 4:t=Z.Y;g.ru(Z,3);break;case 2:b=g.qZ(Z);if(b instanceof g.OM)throw r="offlinePlaylistSyncCheck network manager error: "+b.message,tD(r,b),Error(r);tD("offlinePlaylistSyncCheck fetch request error",b);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:q=nj(t);if(!t)throw tD("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(q!==void 0)P6(q,"playlist sync");else if(!t.offlinePlaylistSyncCheckDatas||!t.offlinePlaylistSyncCheckDatas.length)throw tD("No data for playlist sync"),Error("No data for playlist sync");return Z.return(t.offlinePlaylistSyncCheckDatas.map(function(F){return F.offlinePlaylistSyncCheckData}))}})},B6=function(m){this.L=m},Ao6=function(m,M){var e,I,t,Y,b,r;
return g.p(function(q){switch(q.L){case 1:e=new Map,I=g.P(M),t=I.next();case 2:if(t.done){q.k7(4);break}Y=t.value;b=e;r=b.set;return g.T(q,m.Y(Y),5);case 5:r.call(b,Y,q.Y);t=I.next();q.k7(2);break;case 4:return q.return(e)}})},hD=function(m,M,e,I,t,Y){M=g.db(M,e);
I=Object.assign({},Y,{priority:I,retryScheduleIntervalsInSeconds:t});return{actionType:m,entityKey:M,actionMetadata:I}},wp=function(m,M,e,I,t,Y){this.status=m;
this.L=M;this.B=e;this.Y=I;this.D=t;this.downloadState=Y},DUg=function(m,M,e){this.L=m;
this.V=M;this.D=e},aTd=function(m,M){var e,I,t,Y,b,r,q,Z,F;
return g.p(function(C){switch(C.L){case 1:return e=M.entityKey,t=(I=g.U(M.actionMetadata,om))==null?void 0:I.isEnqueuedForExpiredStreamUrlRefetch,g.bf(C,2),Y=void 0,g.T(C,$UT(m,M),4);case 4:Y=C.Y;g.bf(C,5);var R=(R=g.U(M.actionMetadata,om))?{maximumDownloadQuality:R.maximumDownloadQuality}:void 0;return g.T(C,lT0(e,m.V,{isEnqueuedForExpiredStreamUrlRefetch:t,zL:R,offlineSourceData:Y}),7);case 7:b=C.Y;g.ru(C,6,2);break;case 5:return g.qZ(C,2),r=q4(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",tD("PDE handleAdd error"),C.return(zH(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",r,"DOWNLOAD_STATE_FAILED"));case 6:return g.T(C,GrK(m,b,M),8);case 8:return C.return(zH(M,!0,b.orchestrationActions));case 2:return q=g.qZ(C),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Wo&&q.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tD("PDE handleAdd error"),C.return(zH(M,!1,void 0,Z,F,"DOWNLOAD_STATE_FAILED"))}})},LNT=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id;
return g.p(function(bW){switch(bW.L){case 1:return e=M.entityKey,I=g.aK(e).entityId,g.T(bW,Ll(m.L,{mode:"readonly",uS:!0},function(CO){var tm=A3(CO,e,"playbackData"),j$=A3(CO,g.db(I,"offlineVideoPolicy"),"offlineVideoPolicy");CO=A3(CO,g.db(I,"transfer"),"transfer");return g.iR.all([tm,j$,CO])}),2);
case 2:t=bW.Y;Y=g.P(t);b=Y.next().value;r=Y.next().value;q=Y.next().value;Z=b;F=r;C=q;if(!Z||!F)return bW.return(zH(M,!0));R=[];N=((W=Z)==null?0:W.playerResponseJson)?JSON.parse(Z.playerResponseJson):null;if(!(C&&N&&m.V.U("html5_refresh_deprecated_downloads"))){bW.k7(3);break}H=dUu(m,N,C);return g.T(bW,OoT(m,C),4);case 4:R=bW.Y;case 3:y={lastPlayerResponseTimestampSeconds:Z.playerResponseTimestamp,offlineToken:F.offlineToken,formatIds:R};n={};if((E=C)==null?0:E.maximumDownloadQuality)n.maximumDownloadQuality=
C.maximumDownloadQuality;g.bf(bW,5);B=void 0;return g.T(bW,$UT(m,M),7);case 7:return B=bW.Y,g.bf(bW,8),g.T(bW,lT0(e,m.V,{refreshData:y,zL:n,offlineSourceData:B,mediaCapabilities:H}),10);case 10:w=bW.Y;g.ru(bW,9,5);break;case 8:return g.qZ(bW,5),x=q4(M)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",tD("PDE handleRefresh error"),bW.return(zH(M,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",x,"DOWNLOAD_STATE_FAILED"));
case 9:return g.T(bW,GrK(m,w,M),11);case 11:return bW.return(zH(M,!0,w.orchestrationActions));case 5:return l=g.qZ(bW),Mw="PDE handleRefresh error",l instanceof Error&&(Mw="PDE handleRefresh error: "+l.message),e$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Id="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Wo&&l.type==="QUOTA_EXCEEDED"&&(e$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Id="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tD(Mw),bW.return(zH(M,
!1,void 0,e$,Id,"DOWNLOAD_STATE_FAILED"))}})},$UT=function(m,M){var e,I,t,Y;
return g.p(function(b){if(b.L==1)return e=g.aK(M.entityKey).entityId,I=g.db(e,"videoDownloadContextEntity"),g.T(b,gC(m.L,I,"videoDownloadContextEntity"),2);t=b.Y;return(Y=t)!=null&&Y.offlineModeType?b.return({offlineModeType:t.offlineModeType}):b.return(void 0)})},GrK=function(m,M,e){var I,t,Y,b,r;
return g.p(function(q){if(q.L==1){if(!M.frameworkUpdates||!g.U(M.frameworkUpdates,yV))return q.return();if(!(g.U(M.frameworkUpdates,yV).mutations&&g.U(M.frameworkUpdates,yV).mutations.length>0&&g.U(M.frameworkUpdates,yV).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return q.k7(2);I=g.aK(g.U(M.frameworkUpdates,yV).mutations[0].entityKey).entityId;return g.T(q,JD(m.L,I),3)}if(q.L!=2){t=q.Y;Y=g.U(e.actionMetadata,om);if(r=(b=Y)==null?void 0:b.playlistId)t.playlistId=r;t.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.sg(m.V)?g.T(q,ik(I,m.L,e,m.D,t),2):g.XG(m.V)?g.T(q,fj(I,m.L,e,m.D),2):q.k7(2)}return g.T(q,Uyl(g.U(M.frameworkUpdates,yV)),0)})},zH=function(m,M,e,I,t,Y){return new wp(M?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",q4(m),e,I,t,Y)},dUu=function(m,M,e){M=IT6(m.V,e.cotn,M);
e=g.jJ(M);return g.HF1(M,e,m.V)},OoT=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R;
return g.p(function(H){if(H.L==1)return e=[],g.T(H,Ll(m.L,{mode:"readonly",uS:!0},function(W){var N=[],y=M.offlineVideoStreams;if(y){y=g.P(y);for(var n=y.next();!n.done;n=y.next())N.push(A3(W,n.value,"offlineVideoStreams"))}return g.iR.all(N)}),2);
if(I=H.Y)for(t=g.P(I),Y=t.next();!Y.done;Y=t.next())if(b=Y.value,r=void 0,(r=b)==null?0:r.streamsProgress)for(q=b.streamsProgress,Z=0;Z<q.length;Z++)F=q[Z],C=JSON.parse(F.formatStreamBytes),R={itag:C.itag,lmt:C.lastModified,xtags:C.xtags},e.push(R);return H.return(e)})},vwT=function(m,M){this.L=m;
this.V=M},gws=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H;
return g.p(function(W){switch(W.L){case 1:return e=q4(M),g.T(W,Kl(m.L,"videoPlaybackPositionEntity"),2);case 2:I=W.Y;if(I.length===0)return W.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.bf(W,3);return g.T(W,pl.getInstance(),5);case 5:t=W.Y;if(!t)throw Error("prefStorage is undefined");return g.T(W,t.get("psi"),6);case 6:return Y=W.Y,q=(r=(b=Y)==null?void 0:b.Wc)!=null?r:"0",g.T(W,X9s(I,q),7);case 7:return Z=W.Y,F={isPaused:Z.watchHistoryPaused,Wc:Z.syncTimestampUsec},g.T(W,t.set("psi",
F),8);case 8:if(F.isPaused){W.k7(9);break}C=g.U(Z.frameworkUpdates,yV);if(!Z.frameworkUpdates||!C){W.k7(9);break}return g.T(W,Uyl(C),9);case 9:g.ru(W,4);break;case 3:return R=g.qZ(W),H="PPE handleRefresh error: "+(R instanceof Error?R.message:"unknown error"),tD(H),W.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},mf9=function(m,M){var e,I,t,Y,b,r,q,Z;
return g.p(function(F){switch(F.L){case 1:return e=q4(M),I=g.aK(M.entityKey).entityId,g.bf(F,2),g.T(F,pl.getInstance(),4);case 4:t=F.Y;if(!t)throw Error("prefStorage is undefined");return g.T(F,t.get("psi"),5);case 5:Y=F.Y;b=g.U(M.actionMetadata,KN6);if(((r=Y)==null?void 0:r.isPaused)!==!1||(q=b)==null||!q.lastPlaybackPositionSeconds){F.k7(6);break}Z={key:g.db(I,"videoPlaybackPositionEntity"),videoId:I,lastPlaybackPositionSeconds:b.lastPlaybackPositionSeconds};return g.T(F,vz(m.L,Z,"videoPlaybackPositionEntity"),
6);case 6:g.ru(F,3);break;case 2:return g.qZ(F),F.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},M76=function(m,M){var e,I,t;
return g.p(function(Y){switch(Y.L){case 1:e=q4(M);g.bf(Y,2);I=g.aK(M.entityKey).entityId;if(I==="!*$_ALL_ENTITIES_!*$")return g.T(Y,Cog(m.L),5);t=g.db(I,"videoPlaybackPositionEntity");return g.T(Y,FVs(m.L,t),5);case 5:g.ru(Y,3);break;case 2:return g.qZ(Y),Y.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},egK=function(m,M){this.api=m;
this.L=M;this.logger=new g.j8("woffle");this.Y=!1;this.ZL={gQ:this.gQ}},I49=function(m){return g.p(function(M){return M.return(JMd(m))})},t79=function(m){var M;
return g.p(function(e){if(e.L==1)return g.T(e,g.yKd(m),2);M=e.Y;return e.return(M.filter(function(I){return!!I.url}).map(function(I){return I.url}))})},TH=function(m,M){var e=g.GZ(M);
if(e===1||e===0)return Promise.resolve();(e=Yas(m,M))&&e.stopVideo();m.D=0;return I49(M)},XK=function(m,M,e,I){e=e===void 0?!1:e;
I=I===void 0?!0:I;M=typeof M==="string"?M:M.videoDetails.videoId;if(g.GZ(M)===2){var t=Yas(m,M);t&&t.stopVideo();g.ac(M,2);m.D=2;e?bGT(m.L):I&&Q$d(m.L)}},Yas=function(m,M){var e;
return((e=m.player)==null?void 0:e.getVideoData().videoId)===M?m.player:null},s$d=function(m,M){this.L=m;
this.V=M},qas=function(m,M){var e,I;
return g.p(function(t){switch(t.L){case 1:return e=q4(M),g.T(t,gC(m.L,M.entityKey,"transfer"),2);case 2:if(I=t.Y)return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.bf(t,3);return g.T(t,rts(m,M),5);case 5:g.ru(t,4);break;case 3:return g.qZ(t),t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},ZGS=function(m,M){var e,I;
return g.p(function(t){switch(t.L){case 1:return e=q4(M),g.T(t,gC(m.L,M.entityKey,"transfer"),2);case 2:I=t.Y;if(!I||I.transferState!=="TRANSFER_STATE_COMPLETE")return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.bf(t,3);return g.T(t,rts(m,M,!0),5);case 5:g.ru(t,4);break;case 3:return g.qZ(t),t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},Fi0=function(m,M){var e,I,t,Y,b,r,q,Z,F,C;
return g.p(function(R){switch(R.L){case 1:return e=q4(M),I=g.aK(M.entityKey).entityId,g.T(R,Ll(m.L,{mode:"readonly",uS:!0},function(H){var W=A3(H,M.entityKey,"transfer");H=A3(H,g.db(I,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.iR.all([W,H])}),2);
case 2:t=R.Y;Y=g.P(t);b=Y.next().value;r=Y.next().value;q=b;Z=r;if(!q||q.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return R.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.bf(R,3);q.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.T(R,vz(m.L,q,"transfer"),5);case 5:F=g.aK(q.key).entityId;vM9({videoId:F,pZ:q,offlineModeType:(C=Z)==null?void 0:C.offlineModeType});g.ru(R,4);break;case 3:return g.qZ(R),R.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return R.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},rts=function(m,M,e){e=e===void 0?!1:e;
var I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n;return g.p(function(E){switch(E.L){case 1:return I=g.U(M.actionMetadata,Cil),t=g.aK(M.entityKey).entityId,Y=g.db(t,"downloadStatusEntity"),g.T(E,Ll(m.L,{mode:"readonly",uS:!0},function(B){var w=A3(B,Y,"downloadStatusEntity");B=A3(B,g.db(t,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.iR.all([w,B])}),2);
case 2:return b=E.Y,r=g.P(b),q=r.next().value,Z=r.next().value,F=q,C=Z,R="TRANSFER_STATE_TRANSFER_IN_QUEUE",((H=F)==null?void 0:H.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(R="TRANSFER_STATE_PAUSED_BY_USER"),y={key:M.entityKey,transferState:R,cotn:g.ki(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(W=I)==null?void 0:W.maximumDownloadQuality,preferredAudioTrack:(N=I)==null?void 0:N.preferredAudioTrack,transferRetryCount:0,isRefresh:e,hasLoggedFirstStarted:!1},g.T(E,Ll(m.L,
{mode:"readwrite",uS:!0},function(B){var w=[];e&&w.push(ak(B,g.db(t,"offlineVideoStreams")));w.push(G2(B,y,"transfer"));return g.iR.all(w)}),3);
case 3:if(!e){E.k7(4);break}return g.T(E,I49(t),4);case 4:OPd({videoId:t,pZ:y,offlineModeType:(n=C)==null?void 0:n.offlineModeType}),g.Yd(E)}})},Rgs=function(m,M,e,I){if(!m.action.entityKey)throw Error("entityKey is missing.");
var t=g.aK(m.action.entityKey);t={entityType:t.BP,entityId:t.entityId,offlineOrchestrationActionType:m.action.actionType,orchestrationAction:{orchestrationActionId:m.actionId}};M&&(t.offlineOrchestrationActionResult=M.status,t.isRetryable=e?!1:M.L,M.D&&(t.offlineOrchestrationFailureReason=HG6(M.D,t.isRetryable)));var Y,b;if((Y=m.action.actionMetadata)==null?0:(b=Y.offlineLoggingData)==null?0:b.offlineModeType)t.offlineModeType=m.action.actionMetadata.offlineLoggingData.offlineModeType;I&&(t.additionalOrchestrationActions=
I.map(function(r){return{orchestrationActionId:r.actionId}}));
return t},HG6=function(m,M){return m!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||M?m==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&M?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":m:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},WiS=function(m,M){var e={offlineOrchestrationContext:Rgs(m)};
M=BNl(M,e);h7d(Poy(),M,m.rootActionId)},kQC=function(m,M,e,I){I=I===void 0?[]:I;
M={offlineOrchestrationContext:Rgs(m,M,e,I)};M=BNl(3,M);h7d(Poy(),M,m.rootActionId)},UfS=function(){this.actions=[]},V79=function(m,M){M=g.P(M);
for(var e=M.next();!e.done;e=M.next())e=e.value,WiS(e,1),m.actions.push(e);m.actions.sort(m.L)},N3T=function(m,M){if(M)for(var e=0;e<m.actions.length;e++)if(M==="!*$_ALL_ENTITIES_!*$"&&m.actions[e].actionId!==M||M!=="!*$_ALL_ENTITIES_!*$"&&m.actions[e].rootActionId===M&&m.actions[e].actionId!==M)m.actions.splice(e,1),e--},ctS=function(m,M){m=g.P(m.actions);
for(var e=m.next();!e.done;e=m.next())if(e.value.actionId===M)return!0;return!1},pj=function(m,M,e,I,t){g.A.call(this);
var Y=this;this.Y=m;this.BJ=M;this.Y7=e;this.T=I;this.V=t;this.L=new UfS;this.X=new g.Gm;this.D=new g.vR(function(){Y.retry()});
this.S=NaN;this.C=!1;this.ZL={dxr:function(){return Y.L},
iI:function(){return Y.X},
Vlu:function(){return Y.D},
retry:function(){return Y.retry()}};
g.D(this,this.D);this.nE=this.Y.observe(this.D4.bind(this))},yty=function(m,M,e,I,t){var Y;
return g.p(function(b){if(b.L==1)return Y=new pj(m,M,e,I,t),g.T(b,j$f(Y),2);iG0(Y);return b.return(Y)})},iG0=function(m){var M=m.L.actions[0];
return m.B?((M==null?void 0:M.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&m.B[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(m.C=!0),Promise.resolve()):Jt0(m)},Jt0=function(m){var M,e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n;
return g.p(function(E){switch(E.L){case 1:if(m.B)throw Error("Already processing an action");if(m.pE())return E.return();M=m.L.actions.shift();aHs(m.Y7,!M);if(M===void 0)return E.return();M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&M.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&N3T(m.L,M.actionId);e="";M.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&M.rootActionId===M.actionId&&(e=M.actionId);I=[M];m.B=I;if(t=m.BJ[M.entityType]){E.k7(2);break}m.B=
void 0;return g.T(E,Jt0(m),3);case 3:return E.return();case 2:Y=g.P(I);for(b=Y.next();!b.done;b=Y.next())r=b.value,WiS(r,2);g.bf(E,4,5);return g.T(E,Ao6(t,I.map(function(B){return B.action})),7);
case 7:q=E.Y,Z=g.P(I),F=Z.next();case 8:if(F.done){E.k7(10);break}C=F.value;R=q.get(C.action);return g.T(E,f4d(m,C,R),9);case 9:F=Z.next();E.k7(8);break;case 10:N3T(m.L,e);case 5:g.ZK(E);m.B=void 0;g.Fy(E,6);break;case 4:return H=g.qZ(E),tD("Orchestration error",H),g.bf(E,12),g.T(E,uQy(m,I),14);case 14:g.ru(E,5);break;case 12:W=g.qZ(E);tD("Orchestration retry error",W);N=g.P(I);for(y=N.next();!y.done;y=N.next())n=y.value,n.retryScheduleIndex<3&&V79(m.L,[n]);E.k7(5);break;case 6:return g.T(E,Jt0(m),
0)}})},f4d=function(m,M,e){var I,t,Y,b,r,q,Z,F,C,R,H,W;
return g.p(function(N){switch(N.L){case 1:I=M.retryScheduleIndex+2===3;if(e.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){N.k7(2);break}if(e.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){N.k7(0);break}kQC(M,e,I);if(e.L&&M.retryScheduleIndex+1<3)return g.T(N,uQy(m,[M]),0);Y=((t=e)==null?0:t.Y)?e.Y:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";b={entityKey:M.action.entityKey,failureReason:Y};r=void 0;g.sg(m.V)?r="mainVideoDownloadStateEntity":g.XG(m.V)&&(r="musicTrackDownloadMetadataEntity");
if(!r||!e.downloadState){N.k7(7);break}q=g.aK(M.action.entityKey).entityId;return g.T(N,H6(q,r,m.Y,e.downloadState),7);case 7:bk(m.T,b);if(e.downloadState==="DOWNLOAD_STATE_FAILED"&&m.V.U("html5_auto_retry_failed_pde_actions")){N.k7(0);break}tD("Orchestration result is not retryable, deleting action");return g.T(N,FVs(m.Y,N4(M).key),0);case 2:Z=void 0;try{Z=(F=e.B)==null?void 0:F.map(function(y){return m.createAction(y,M)})}catch(y){return kQC(M,e,I),C={entityKey:M.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},bk(m.T,C),tD("Orchestration subactions creation error",y),N.return()}kQC(M,e,I,Z);if(!Z){N.k7(12);break}R=Z.map(function(y){return N4(y)});
H=0;case 13:if(!(H<Z.length)||m.C){N.k7(15);break}return g.T(N,Ll(m.Y,{mode:"readwrite",uS:!0},function(y){var n=[];n.push(e7l(y,R.slice(H,H+10),"offlineOrchestrationActionWrapperEntity"));return g.iR.all(n)}),16);
case 16:H+=10;N.k7(13);break;case 15:if(m.C)return m.C=!1,N.return();case 12:return W=N4(M),g.T(N,FVs(m.Y,W.key),17);case 17:WiS(M,4),g.Yd(N)}})},PiK=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H;
return g.p(function(W){e=[];I=Infinity;t=4E3;Y=g.P(M);for(b=Y.next();!b.done;b=Y.next())r=b.value,q=Number(r.enqueueTimeSec),Z=SaT(q),F=r.retryScheduleIndex,C=F!=null&&F>0,Z>0&&C?(I=Math.min(I,q),t=Math.min(Z,t)):e.push(r);isFinite(I)&&(!m.D.isActive()||I<m.S)&&(m.S=I,m.D.start(t));m.X.xj()||(R=e.length,e=e.filter(function(N){var y;N=((y=N.actionProto)==null?void 0:y.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!EFl.includes(N)}),H=e.length<R,!m.D.isActive()&&H&&m.D.start(1));
e.length>0&&nF9(m,e);return g.T(W,iG0(m),0)})},hg9=function(m){var M,e,I,t,Y,b,r;
return g.p(function(q){if(q.L==1)return g.T(q,B3f(m),2);M=q.Y;e=[];I=g.P(M);for(t=I.next();!t.done;t=I.next())Y=t.value,b=g.aK(Y.key),r=b.entityId,ctS(m.L,r)||e.push(Y);return g.T(q,PiK(m,e),0)})},SaT=function(m){m=m*1E3-Date.now();
return m>4E3?4E3:m},uQy=function(m,M){var e,I,t;
return g.p(function(Y){e=g.P(M);for(I=e.next();!I.done;I=e.next()){t=I.value;var b=void 0,r=void 0,q=((r=t.action)==null?void 0:(b=r.actionMetadata)==null?void 0:b.retryScheduleIntervalsInSeconds)||[1,2,4];b=1;t.retryScheduleIndex<q.length&&(b=q[t.retryScheduleIndex]);t.L=b*1E3+Date.now();t.retryScheduleIndex++}return g.T(Y,wsg(m,M),0)})},j$f=function(m){var M;
return g.p(function(e){if(e.L==1)return g.T(e,Kl(m.Y,"offlineOrchestrationActionWrapperEntity"),2);M=e.Y;return g.T(e,PiK(m,M),0)})},nF9=function(m,M){M.length!==0&&M.forEach(function(e){e=VV(e);
e.retryScheduleIndex<3&&V79(m.L,[e])})},B3f=function(m,M){var e;
return g.p(function(I){if(I.L==1)return g.T(I,Kl(m.Y,"offlineOrchestrationActionWrapperEntity",M),2);e=I.Y;return I.return(e.filter(VU9))})},wsg=function(m,M){if(M.length===0)return Promise.resolve([]);
M=M.map(function(e){return N4(e)});
return ZP0(m.Y,M)},oFS=function(m){this.zO=m;
this.L=void 0},zgd=function(m,M){var e,I,t,Y;
return g.p(function(b){e=M.videoId;I=!0;if(M.captionTracks.length)t=Gy6(M),m.L=new g.Ro(m.zO,M,t);else if(M.Xv)Y=g.TJK(M),m.L=new g.kj(m.zO,M.Xv,e,Y,M.gA,M.eventId),I=M.gA;else return b.return();return b.return(new Promise(function(r){var q;(q=m.L)==null||q.d9({Cg:function(){return g.p(function(Z){if(Z.L==1)return g.T(Z,m.Cg(e,I),2);r();g.Yd(Z)})},
NS:function(){}})}))})},T3y=function(m){var M;
return g.p(function(e){if(e.L==1)return g.T(e,yM9(m),2);M=e.Y;return e.return(!!M&&M.length>0)})},lk=function(m){g.A.call(this);
this.L=m;this.Y=this.L.observe(this.D.bind(this))},XsZ=function(m,M){var e,I,t,Y,b,r,q;
return g.p(function(Z){switch(Z.L){case 1:if(M.length===0)return Z.return([]);e=M.map(function(F){return g.db(F,"transfer")});
return g.T(Z,Kl(m.L,"transfer",e),2);case 2:I=Z.Y;t=I.filter(VU9).map(function(F){return g.aK(F.key).entityId});
Y=M.filter(function(F){return t.indexOf(F)===-1});
if(Y.length===0)return Z.return([]);b=g.P(Y);r=b.next();case 3:if(r.done){Z.k7(5);break}q=r.value;return g.T(Z,I49(q),4);case 4:r=b.next();Z.k7(3);break;case 5:return Z.return(Y)}})},xf9=function(m,M,e,I,t,Y){var b,r,q;
return g.p(function(Z){b="STREAM_TYPE_UNKNOWN";e.video&&e.audio?(b="STREAM_TYPE_AUDIO_AND_VIDEO",tD("unexpected stream type")):e.video&&!e.audio?b="STREAM_TYPE_VIDEO":!e.video&&e.audio&&(b="STREAM_TYPE_AUDIO");r=g.db(M,"offlineVideoStreams");q={numBytesDownloaded:t.toFixed(),numTotalBytes:Y.toFixed(),streamType:b,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(I),itag:b==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(e.itag):void 0};return g.T(Z,Ll(m,{mode:"readwrite",uS:!0},
function(F){var C=A3(F,r,"offlineVideoStreams"),R=A3(F,g.db(M,"transfer"),"transfer");return g.iR.all([C,R]).then(function(H){H=g.P(H);var W=H.next().value;H=H.next().value;if(!H)return ak(F,r).then(function(){});
var N=psu(W);W=l40(W,I,q,r);var y=G2(F,W,"offlineVideoStreams");psu(W)>N&&(H.lastProgressTimeMs=Date.now().toString());N=[y];H.offlineVideoStreams||(H.offlineVideoStreams=[]);H.offlineVideoStreams.indexOf(r)===-1&&(H.offlineVideoStreams.push(r),N.push(G2(F,H,"transfer")));return g.iR.all(N)})}),0)})},AtT=function(m,M){var e,I,t,Y,b;
return g.p(function(r){if(r.L==1)return e=g.db(M,"offlineVideoStreams"),g.T(r,gC(m,e,"offlineVideoStreams"),2);I=r.Y;if(!I||!I.streamsProgress)return r.return();t=g.P(I.streamsProgress);for(Y=t.next();!Y.done;Y=t.next())b=Y.value,b.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",b.numTotalBytes!==b.numBytesDownloaded&&(b.numBytesDownloaded=b.numTotalBytes);return g.T(r,vz(m,I,"offlineVideoStreams"),0)})},l40=function(m,M,e,I){if(m&&m.streamsProgress){I=m;
a:{M=M.itag+";"+M.xtags;for(var t=m.streamsProgress,Y=0;Y<t.length;Y++){var b=JSON.parse(t[Y].formatStreamBytes);if(b.itag+";"+b.xtags===M){t[Y]=e;e=t;break a}}t.push(e);e=t}I.streamsProgress=e}else m={key:I,streamsProgress:[e]};return m},psu=function(m){if(m==null?0:m.streamsProgress){var M=0;
m=m.streamsProgress;for(var e=0;e<m.length;e++){var I=m[e];isNaN(Number(I.numBytesDownloaded))?tD("stream progress bytes number invalid"):M+=Number(I.numBytesDownloaded)}return M}return 0},Df9=function(m,M,e,I){g.A.call(this);
var t=this;this.Y=m;this.api=M;this.TO=e;this.D4=I;this.X=new g.Gm;this.B=new g.vR(function(){t.L&&t.L.transferState==="TRANSFER_STATE_TRANSFERRING"&&t.X.xj()&&((t.L.transferRetryCount||0)<3?XK(t.T,t.C,!1,!1):TH(t.T,t.C.videoDetails.videoId),t.ej("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Y7=this.lX=0;this.nE=this.S=!1;this.iX=g.KE(this.api.K().experiments,"html5_transfer_processing_logs_interval");this.XC=new g.CV(this);this.ZL={BBE:function(){return t.B},
wi7:function(){return t.D4},
iI:function(){return t.X}};
this.BJ=this.Y.observe(this.hT.bind(this));this.T=new egK(M,this);this.cJ=new oFS(M);this.GO=new lk(this.Y);this.fE=this.X.listen("publicytnetworkstatus-online",this.WG.bind(this));this.Rt=this.X.listen("publicytnetworkstatus-offline",this.zOY.bind(this));this.nE=this.api.K().U("html5_less_transfer_processing_logs");g.D(this,this.XC);this.XC.Z(M,"offlinetransferpause",this.Tu4);if(g.sg(this.api.K()))this.D="mainVideoDownloadStateEntity";else if(g.XG(this.api.K())||g.qS(this.api.K()))this.D="musicTrackDownloadMetadataEntity"},
$fg=function(m){return g.p(function(M){if(M.L==1)M=g.T(M,jA9(),2);
else{var e=m.GO;var I=g.$o();I=Object.keys(I);e=XsZ(e,I);M=g.T(M,e,0)}return M})},AD=function(m,M){M=M===void 0?!1:M;
var e;return g.p(function(I){if(I.L==1){if(m.L)throw Error("Already downloading a video");m.Y7=0;m.S=!1;return g.T(I,GQl(m),2)}return I.L!=4?(e=I.Y,dyZ(m.TO,!e),e&&m.X.xj()?M?g.T(I,new Promise(function(t){g.cV(t,1E3)}),4):I.k7(4):(!e&&m.L&&x4(m),I.k7(0))):g.T(I,a40(m,e),0)})},dfd=function(m){return g.p(function(M){if(M.L==1)return m.C?g.T(M,TH(m.T,m.C.videoDetails.videoId),3):M.k7(0);
x4(m);g.Yd(M)})},OGf=function(m,M){var e,I,t;
return g.p(function(Y){switch(Y.L){case 1:return g.bf(Y,2),(e=!!M.captionTracks.length||!!M.Xv)?g.T(Y,T3y(M.videoId),4):Y.return();case 4:return(I=Y.Y)?Y.return():g.T(Y,zgd(m.cJ,M),5);case 5:g.ru(Y,0);break;case 2:t=g.qZ(Y),tD("Caption downloading error",t,M.cotn),g.Yd(Y)}})},a40=function(m,M){var e,I,t,Y,b,r;
return g.p(function(q){switch(q.L){case 1:if(m.S)return q.return();m.S=!0;m.L=M;e=g.aK(m.L.key);I=e.entityId;t=void 0;if(m.L.transferState==="TRANSFER_STATE_TRANSFERRING")return g.T(q,DJ(m,I),7);if(m.L.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||m.L.transferRetryCount||m.L.hasLoggedFirstStarted){q.k7(3);break}return g.T(q,DJ(m,I),5);case 5:return t=q.Y,m.L.hasLoggedFirstStarted=!0,g.T(q,Lis(m),6);case 6:LVy({videoId:I,pZ:m.L,offlineModeType:t},void 0,void 0,!0);q.k7(3);break;case 7:t=q.Y,
rp({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:I,pZ:m.L,offlineModeType:t});case 3:return g.T(q,vFT(m),8);case 8:return Y=null,g.bf(q,9),g.T(q,gFK(m,M),11);case 11:Y=q.Y;m.C=Y;g.ru(q,10);break;case 9:return b=g.qZ(q),tD("error getting player response",b,M.cotn),g.T(q,m.ej("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return q.return();case 10:return r=IT6(m.api.K(),M.cotn,Y),g.T(q,OGf(m,r),13);case 13:return g.T(q,t79(r.videoId),
14);case 14:r.PU=q.Y;var Z=m.T,F=r,C=M.maximumDownloadQuality;F.getPlayerResponse();g.ac(F.videoId,2);Z.D=2;Z.Y=!1;var R;(R=Z.player)==null||R.dispose();Z.player=Z.api.sy(F);F={};Z.player.xQ((F.localmediachange=Z.uL,F.signatureexpired=Z.SO,F.statechange=Z.oeE,F),Z);Z.U("html5_generate_content_po_token")&&Z.player.fJ();C=Z.gQ(C);Z.player.HI(g.zv(C,C,!0,"m"),!1);Z.player.TK(!1);m.B.start(108E5);g.Yd(q)}})},GQl=function(m){var M,e;
return g.p(function(I){if(I.L==1)return g.T(I,Kl(m.Y,"transfer"),2);M=I.Y;e=M.filter(Ki0).sort(mMg);return e.length===0?I.return():I.return(e[0])})},vFT=function(m){var M,e,I;
return g.p(function(t){if(t.L==1){if(!m.L)return $4(m,"onTransferStart"),t.return();m.B.start(108E5);return g.T(t,GH(m,"TRANSFER_STATE_TRANSFERRING"),2)}M=m.L;return(I=((e=M)==null?0:e.key)?g.aK(M.key).entityId:"")&&m.D?g.T(t,H6(I,m.D,m.Y,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):t.k7(0)})},bGT=function(m){var M,e,I,t;
g.p(function(Y){switch(Y.L){case 1:if(!m.L){$4(m,"onTransferPausedByUser");Y.k7(2);break}M=m.L;m.B.stop();return g.T(Y,GH(m,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:I=((e=M)==null?0:e.key)?g.aK(M.key).entityId:"";if(!I||!m.D){Y.k7(4);break}return g.T(Y,H6(I,m.D,m.Y,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.T(Y,DJ(m,I),6);case 6:t=Y.Y,gMf({videoId:I,pZ:M,offlineModeType:t});case 2:x4(m),AD(m),g.Yd(Y)}})},Q$d=function(m){var M,e,I;
g.p(function(t){if(t.L==1){if(!m.L)return $4(m,"onTransferPausedByNetwork"),t.return();m.B.stop();return g.T(t,GH(m,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(t.L!=3)return M=m.L,(I=((e=M)==null?0:e.key)?g.aK(M.key).entityId:"")&&m.D?g.T(t,H6(I,m.D,m.Y,"DOWNLOAD_STATE_PAUSED"),3):t.k7(3);x4(m);g.Yd(t)})},MrZ=function(m){var M,e,I,t,Y;
g.p(function(b){switch(b.L){case 1:if(!m.L)return $4(m,"onTransferComplete"),b.return();M=m.L;m.B.stop();if(!M||!m.C){b.k7(2);break}e=IT6(m.api.K(),M.cotn,m.C);return g.T(b,OGf(m,e),2);case 2:return g.T(b,GH(m,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:t=((I=M)==null?0:I.key)?g.aK(M.key).entityId:"";if(!t||!m.D){b.k7(5);break}return g.T(b,H6(t,m.D,m.Y,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.T(b,AtT(m.Y,t),7);case 7:return g.T(b,DJ(m,t),8);case 8:Y=b.Y,rp({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:t,pZ:M,offlineModeType:Y}),x4(m),AD(m),g.Yd(b)}})},eXS=function(m,M,e){var I,t;
g.p(function(Y){switch(Y.L){case 1:if(!m.L)return $4(m,"onTransferProgress: "+M),Y.return();if(m.L.transferState==="TRANSFER_STATE_TRANSFERRING"){Y.k7(2);break}return g.T(Y,vFT(m),2);case 2:I=Date.now();if(!(I-m.lX>1E3)){Y.k7(4);break}m.lX=I;return g.T(Y,xf9(m.Y,e.videoId,e.Y,e.J7,e.bytesDownloaded,e.L),5);case 5:if(m.nE&&!(m.nE&&I-m.Y7>m.iX)){Y.k7(4);break}m.Y7=I;return g.T(Y,DJ(m,M),7);case 7:t=Y.Y,LVy({videoId:M,pZ:m.L,offlineModeType:t},e.bytesDownloaded,e.L);case 4:m.B.start(108E5),g.Yd(Y)}})},
IyC=function(m){var M=(m.L.transferRetryCount||0)<3;
M&&(m=m.L,m.transferRetryCount=(m.transferRetryCount||0)+1);return M},trT=function(m,M){M=M===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":M;
var e,I,t,Y;return g.p(function(b){if(b.L==1)return m.L||$4(m,"setTransferToFailed: "+M),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M==="TRANSFER_FAILURE_REASON_NETWORK"?e="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":M==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.T(b,GH(m,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",M),2);if(b.L!=3)return bk(m.D4,{entityKey:(I=m.L)==null?void 0:I.key,failureReason:e}),
t=m.L?g.aK(m.L.key).entityId:"",g.T(b,DJ(m,t),3);Y=b.Y;var r={videoId:t,pZ:m.L,offlineModeType:Y},q=M,Z={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};q&&(Z.transferFailureReason=q,Z.failureReason=KV0(q));rp(Z,r);g.Yd(b)})},GH=function(m,M,e,I){var t;
return g.p(function(Y){if(Y.L==1){if(!m.L)return $4(m,"saveTransferState: "+M),Y.return();m.L.transferState=M;m.L.failureReason=I;g.bf(Y,2);return g.T(Y,Lis(m,function(b){return e?DQ(b,"offlineVideoStreams",m.L.offlineVideoStreams).then(function(r){for(var q=g.P(r),Z=q.next();!Z.done;Z=q.next())if((Z=Z.value)&&Z.streamsProgress){Z=g.P(Z.streamsProgress);for(var F=Z.next();!F.done;F=Z.next())F.value.streamState=e}return e7l(b,r.filter(function(C){return!!C}),"offlineVideoStreams")}):g.iR.resolve(void 0)}),
4)}if(Y.L!=2)return g.ru(Y,0);
t=g.qZ(Y);return t instanceof g.Wo&&t.type==="QUOTA_EXCEEDED"?g.T(Y,m.ej("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):Y.k7(0)})},Lis=function(m,M){var e;
return g.p(function(I){if(!m.L)return I.return();e=m.L;return g.T(I,Ll(m.Y,{mode:"readwrite",uS:!0},function(t){var Y=[G2(t,e,"transfer")];M&&Y.push(M(t));return g.iR.all(Y)}),0)})},x4=function(m){m.L=void 0;
m.C=void 0;m.B.stop()},gFK=function(m,M){var e,I,t,Y,b;
return g.p(function(r){if(r.L==1)return e=g.aK(M.key),I=e.entityId,t=g.db(I,"playbackData"),g.T(r,gC(m.Y,t,"playbackData"),2);Y=r.Y;if((b=Y)==null?0:b.playerResponseJson)return r.return(JSON.parse(Y.playerResponseJson));throw Error("No PlayerResponse found");})},$4=function(m,M){m.api.It("woffle",{mcte:M});
tD("missing current transfer entity.")},DJ=function(m,M){var e,I,t;
return g.p(function(Y){if(Y.L==1)return g.T(Y,gC(m.Y,g.db(M,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);e=Y.Y;return Y.return((t=(I=e)==null?void 0:I.offlineModeType)!=null?t:void 0)})},Ki0=function(m){return YL0[m.transferState]!==void 0},mMg=function(m,M){var e=YL0[m.transferState],I=YL0[M.transferState];
return e!==I?e-I:Number(m.enqueuedTimestampMs)-Number(M.enqueuedTimestampMs)},am=function(m,M){var e=this;
this.V=m;this.api=M;this.X=new g.Gm;this.C=new g.FU;this.ZL={sS:function(){return e.D.ZL.sS()},
iI:function(){return e.X},
ixn:function(){return e.D},
GB:function(){return e.GB()},
Dp:function(){return e.Dp()},
B$:function(){return e.B$()},
xm:function(){return e.xm()},
Cf:function(){return e.Cf()},
aT:function(I){return e.aT(I)}};
this.D=new Dyg(function(){return bS9(e)},function(){e.B$()},this.api.Az(),this.api.U.bind(this.api));
this.L=new Y4(this.api);$y9(this.D)},bS9=function(m){return g.p(function(M){m.api.FC("onOrchestrationBecameLeader");
return g.T(M,m.Dp(),0)})},sES=function(m){var M,e;
return g.p(function(I){if(I.L==1)return g.T(I,mQ(),2);if(I.L!=3){M=I.Y;if(!M)return tD("PES is undefined"),I.return();m.Y=new Df9(M,m.api,m.D,m.L);e=m.B8(M);return g.T(I,yty(M,e,m.D,m.L,m.V),3)}m.T=I.Y;return g.T(I,QEC(m),0)})},QEC=function(m){var M;
return g.p(function(e){switch(e.L){case 1:if(!m.Y)return tD("transferManager is undefined"),e.return();if(m.Y.L){e.k7(2);break}return g.T(e,AD(m.Y),2);case 2:if(!m.V.U("woffle_enable_main_downloads_library")){e.k7(4);break}return g.T(e,m.q6(),4);case 4:if(!m.V.U("html5_offline_playback_position_sync")){e.k7(6);break}return g.T(e,m.o1(),7);case 7:return g.T(e,m.aT(864E5),6);case 6:return g.T(e,m.refreshAllStaleEntities(43200,!0),9);case 9:return g.T(e,m.Ze(),10);case 10:if(!m.V.U("html5_retry_downloads_for_expiration")){e.k7(11);
break}return g.T(e,m.Cf(),11);case 11:return m.S=g.jK(function(){m.refreshAllStaleEntities(43200,!0);m.Ze()},9E5),g.Mq(g.I1(),function(){return m.xm()}),g.T(e,mQ(),13);
case 13:return M=e.Y,g.T(e,AMf(M),14);case 14:Gbg(m.D),g.Yd(e)}})},rXT=function(){var m,M,e,I,t,Y;
return g.p(function(b){switch(b.L){case 1:return g.T(b,mQ(),2);case 2:m=b.Y;if(!m)return b.return([]);M=Date.now()/1E3;return g.T(b,Kl(m,"offlineVideoPolicy"),3);case 3:e=b.Y,I=g.P(e),t=I.next();case 4:if(t.done){b.k7(6);break}Y=t.value;if(!(Y.expirationTimestamp&&Number(Y.expirationTimestamp)<M)){b.k7(5);break}Y.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";Y.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.T(b,vz(m,Y,"offlineVideoPolicy"),5);
case 5:t=I.next();b.k7(4);break;case 6:return b.return(e.map(function(r){return r.key}))}})},dp=function(m,M,e,I,t){var Y,b,r;
return g.p(function(q){if(q.L==1)return g.T(q,mQ(),2);Y=q.Y;if(!Y)return q.return([]);b=M.map(function(Z){var F=g.db(Z,e);F={actionType:I,entityKey:F,actionMetadata:Object.assign({},tnu(),t)};I!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(F.actionMetadata.priority=0);Z=new Uy(e,Z,F);return N4(Z)});
r=ZP0(Y,b);$y9(m.D);return q.return(r)})},qLC=function(m,M,e,I){var t,Y,b,r,q,Z,F,C;
return g.p(function(R){switch(R.L){case 1:t=[],Y=g.P(M),b=Y.next();case 2:if(b.done){R.k7(4);break}r=b.value;if(r.upToDate||e&&!r.shouldAutoSyncMetadata||!r.playlistId){R.k7(3);break}q={};switch(I){case "mainPlaylistEntity":Z={nextAutoRefreshIntervalSeconds:r.checkInSeconds,autoSync:e};q={mainPlaylistEntityActionMetadata:Z};break;case "musicPlaylist":F={autoSync:e},q={musicPlaylistEntityActionMetadata:F}}return g.T(R,dp(m,[r.playlistId],I,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q),6);case 6:(C=
R.Y)&&t.push.apply(t,g.h(C));case 3:b=Y.next();R.k7(2);break;case 4:return R.return(t)}})},ZSl=function(m,M){var e;
return g.p(function(I){return M.length?(e=tnu(),g.Xf(e,om,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m.api.It("qrd",{v:M.length}),I.return(dp(m,M,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e))):I.return([])})},FO6=function(m,M,e){this.L=m;
this.V=M;this.D=e},RXu=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E;
return g.p(function(B){switch(B.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,Y=[],g.bf(B,2),g.T(B,CVS(m,t),4);case 4:Y=B.Y;if(!(m.V.U("woffle_enable_main_downloads_library")&&((b=Y)==null?0:b.length))){B.k7(5);break}return g.T(B,krS(m.L,[M.entityKey]),5);case 5:g.ru(B,3);break;case 2:return r=g.qZ(B),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.Wo&&r.type==="QUOTA_EXCEEDED"?(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):tD("Playlist add error"),B.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,q,Z));case 3:F=[];if(!m.V.U("html5_offline_prevent_redownload_downloaded_video")){B.k7(7);break}return g.T(B,ed9(m.L,"mainVideoEntity",Y),8);case 8:Y=B.Y;case 7:if((C=Y)==null?0:C.length)for(R=g.P(Y),H=R.next();!H.done;H=R.next())if(W=H.value,N=W.offlineVideoData,y=void 0,(y=N)==null?0:y.videoId)n=void 0,E=Number(((n=M.actionMetadata)==null?void 0:n.priority)||
0)+1,F.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",N.videoId,"mainVideoEntity",E,Oy,HST(M,N,t)));return B.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,F))}})},kag=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8,n6,J,ms,jM,rw,dw,q9,KO,es,u2,u,c,f,z,d,s7,L,G,X,P1,B1,U7,E7,tg,uW,xt,OY,vS,nO,AS,hm,y0,xb,pk,Jg;
return g.p(function(mh){switch(mh.L){case 1:return e=q4(M),I=M.entityKey,t=g.aK(I).entityId,Y=[],b=!1,t==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.T(mh,Kl(m.L,"mainPlaylistEntity"),5)):g.T(mh,gC(m.L,I,"mainPlaylistEntity"),4);case 4:(r=mh.Y)&&Y.push(r);mh.k7(3);break;case 5:Y=mh.Y;case 3:if((q=Y)==null||!q.length)return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));Z=g.U(M.actionMetadata,WOT);C=(F=Z)==null?void 0:F.nextAutoRefreshIntervalSeconds;H=(R=Z)==null?void 0:R.autoSync;W=[];y=N=
!0;n=!1;if(!b&&H===!1){mh.k7(6);break}g.bf(mh,7);return g.T(mh,P1f(0,!!H,!0,Y),9);case 9:W=mh.Y;g.ru(mh,8);break;case 7:E=g.qZ(mh);if(!(E instanceof Error&&E.message==="No data")){E instanceof Error&&E.message==="Empty response body"&&tD(E.message);mh.k7(8);break}return t==="!*$_ALL_ENTITIES_!*$"?g.T(mh,Zoy(m.L,M,m.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.T(mh,rou(t,m.L,M,m.D),8);case 8:if(!W.length||!b&&W[0].playlistId!==t)return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));case 6:if(b){B=[];w=g.P(W);for(x=w.next();!x.done;x=w.next())l=x.value,l.upToDate||H&&!l.shouldAutoSyncMetadata||!l.playlistId||(Mw={nextAutoRefreshIntervalSeconds:l.checkInSeconds,autoSync:H},B.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l.playlistId,"mainPlaylistEntity",0,Oy,{mainPlaylistEntityActionMetadata:Mw})));return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,B))}W.length&&(e$=W[0],n=!!e$.upToDate,H&&(N=(Id=e$.shouldAutoSyncMetadata)!=null?Id:!0,y=(bW=e$.shouldAutoSyncVideos)!=
null?bW:!0,e$.checkInSeconds&&(C=e$.checkInSeconds)));if(n||!N)return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));CO=[];tm=Y[0];if(!tm.downloadState){j$=void 0;mh.k7(15);break}return g.T(mh,gC(m.L,tm.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:j$=mh.Y;case 15:return g8=j$,lW=((Q0=g8)==null?0:Q0.addedTimestampMillis)?String(g8.addedTimestampMillis):void 0,g.bf(mh,17),g.T(mh,CVS(m,t,lW,C),19);case 19:CO=mh.Y;g.ru(mh,18);break;case 17:LO=g.qZ(mh);if(!(LO instanceof
Error&&LO.message==="No data for playlist")){if(LO instanceof Error&&LO.message==="Empty response body for playlist")tD(LO.message);else return zK="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",LO instanceof g.Wo&&LO.type==="QUOTA_EXCEEDED"&&(zK="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,zK,L6));
mh.k7(18);break}return g.T(mh,rou(t,m.L,M,m.D),18);case 18:if(!y)return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));BS=[];S=new Map;if((K6=CO)==null?0:K6.length)for(Ag=g.P(CO),r8=Ag.next();!r8.done;r8=Ag.next())n6=r8.value,J=n6.offlineVideoData,ms=void 0,((ms=J)==null?0:ms.videoId)&&S.set(J.videoId,J);jM=new Map;rw=[];if((dw=tm)==null?0:(q9=dw.videos)==null?0:q9.length)for(KO=g.P(tm.videos),es=KO.next();!es.done;es=KO.next())if(u2=es.value,u=JSON.parse(g.aK(u2).entityId),c=
u.videoId)S.has(c)?(jM.set(c,S.get(c)),S.delete(c)):rw.push(c);z=Number(((f=M.actionMetadata)==null?void 0:f.priority)||0)+1;d=g.P(S.entries());for(s7=d.next();!s7.done;s7=d.next())L=s7.value,G=g.P(L),X=G.next().value,P1=G.next().value,B1=X,U7=P1,BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B1,"mainVideoEntity",z,Oy,HST(M,U7,t)));E7=g.P(jM.entries());for(tg=E7.next();!tg.done;tg=E7.next())uW=tg.value,xt=g.P(uW),OY=xt.next().value,vS=xt.next().value,nO=OY,AS=vS,BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
nO,"mainVideoEntity",z,Oy,HST(M,AS,t)));hm=g.P(rw);for(y0=hm.next();!y0.done;y0=hm.next())xb=y0.value,pk={playlistId:t},Jg={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:pk},BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",xb,"mainVideoEntity",0,Oy,Jg));return mh.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,BS))}})},UMC=function(m,M){var e,I,t,Y;
return g.p(function(b){switch(b.L){case 1:return e=q4(M),g.bf(b,2),I=g.aK(M.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.T(b,Zoy(m.L,M,m.D,(t=M.actionMetadata)==null?void 0:(Y=t.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.T(b,rou(I,m.L,M,m.D),6);case 6:if(!m.V.U("woffle_enable_main_downloads_library")){b.k7(5);break}return g.T(b,UUl(m.L,M.entityKey),5);case 5:g.ru(b,3);break;case 2:return g.qZ(b),b.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},CVS=function(m,M,e,I){var t,Y,b,r,q,Z,F;
return g.p(function(C){switch(C.L){case 1:return g.T(C,Ewl([M]),2);case 2:return t=C.Y,g.T(C,Vr9(m,t[0],e,I),3);case 3:return Y=C.Y,b=Y.mainPlaylistEntity,r=Y.crC,Z=QwZ(b,(q=r)==null?void 0:q.avatar),g.bf(C,4),g.T(C,jE(Z),6);case 6:g.ru(C,5);break;case 4:F=g.qZ(C),F instanceof Error&&F.message==="Failed to fetch"&&tD(F.message);case 5:return C.return(t[0].videos)}})},Vr9=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w;
return g.p(function(x){switch(x.L){case 1:t=Date.now().toString();e||(e=t);Y=M.videos;b=M.playlistId;r=[];q=[];if(Y)for(Z=g.P(Y),F=Z.next();!F.done;F=Z.next()){C=F.value;R=C.offlineVideoData;if(!R||!R.videoId)throw tD("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");H=R.videoId;W={videoId:H,playlistId:b};N={id:g.db(JSON.stringify(W),"mainPlaylistVideoEntity"),video:g.db(H,"mainVideoEntity")};r.push(N);q.push(N.id)}n={key:g.db(b,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:e,lastSyncedTimestampMillis:t};E={key:g.db(b,"mainPlaylistEntity"),playlistId:b,videos:q,title:M.title,thumbnailStyleData:NST(M),visibility:cXT(M),downloadState:n.key};M.channel&&(B=M.channel.offlineChannelData,y=jE6(g.db(b,"ytMainChannelEntity"),B),E.channelOwner=y.id);((w=E)==null?0:w.entityMetadata)?(E.entityMetadata.offlineLastModifiedTimestampSeconds=M.lastModifiedTimestamp,I&&(E.entityMetadata.nextAutoRefreshIntervalSeconds=String(I))):E&&(E.entityMetadata={nextAutoRefreshIntervalSeconds:I?
String(I):void 0,offlineLastModifiedTimestampSeconds:M.lastModifiedTimestamp});g.bf(x,2);return g.T(x,Ll(m.L,{mode:"readwrite",uS:!0},function(l){var Mw=G2(l,E,"mainPlaylistEntity"),e$=G2(l,n,"mainPlaylistDownloadStateEntity");Mw=[Mw,e$];e$=g.P(r);for(var Id=e$.next();!Id.done;Id=e$.next())Mw.push(G2(l,Id.value,"mainPlaylistVideoEntity"));y&&Mw.push(G2(l,y,"ytMainChannelEntity"));return g.iR.all(Mw)}),4);
case 4:g.ru(x,3);break;case 2:throw g.qZ(x),tD("PES failure for playlist"),Error("PES failure for playlist");case 3:return x.return({mainPlaylistEntity:E,crC:y,AJG:r})}})},jE6=function(m,M){return{id:m,
channelId:M.channelId,title:M.title,avatar:M.thumbnail}},NST=function(m){var M=[],e=m.videos;
e&&e.length>0&&M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:e[0].offlineVideoData.thumbnail}}});if((m=m.additionalMetadadatas)&&m.length>0)for(m=g.P(m),e=m.next();!e.done;e=m.next()){var I=e.value.offlineBundleItemPlaylistData,t=void 0;e=(t=I)==null?void 0:t.style;t=void 0;I={collageThumbnail:{coverThumbnail:(t=I)==null?void 0:t.coverThumbnail}};switch(e){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:I});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":M.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:I})}}return M},cXT=function(m){switch(m.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},HST=function(m,M,e){M={offlineVideoData:M,
playlistId:e};if(m=g.U(m.actionMetadata,WOT))M.maximumDownloadQuality=m.maximumDownloadQuality;return{mainVideoEntityActionMetadata:M}},iSg=function(m,M,e){this.L=m;
this.V=M;this.D=e},fys=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W;
return g.p(function(N){switch(N.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,Y=g.U(M.actionMetadata,Lj),r=!((b=Y)==null?0:b.playlistId),g.bf(N,2),g.T(N,yXT(m,t,void 0,(q=Y)==null?void 0:q.offlineVideoData,r),4);case 4:g.ru(N,3);break;case 2:return Z=g.qZ(N),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.Wo&&Z.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
N.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,F,C));case 3:R=1;R=Number(((H=M.actionMetadata)==null?void 0:H.priority)||0)+1;var y=(y=g.U(M.actionMetadata,Lj))?{playbackDataActionMetadata:{maximumDownloadQuality:y.maximumDownloadQuality}}:void 0;W=hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t,"playbackData",R,JX9,y);return N.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,[W]))}})},uUZ=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E;
return g.p(function(B){switch(B.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,g.T(B,gC(m.L,M.entityKey,"mainVideoEntity"),2);case 2:Y=B.Y;if(!Y){b=void 0;B.k7(3);break}return g.T(B,gC(m.L,Y.downloadState,"mainVideoDownloadStateEntity"),4);case 4:b=B.Y;case 3:r=b;if(!Y||!r)return B.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));g.bf(B,5);return g.T(B,yXT(m,t,r.addedTimestampMillis,(Z=g.U(M.actionMetadata,Lj))==null?void 0:Z.offlineVideoData),7);case 7:F=1;F=Number(((C=
M.actionMetadata)==null?void 0:C.priority)||0)+1;q=hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t,"playbackData",F,JX9);g.ru(B,6);break;case 5:R=g.qZ(B);if(!(R instanceof Error&&R.message==="No data")){if(R instanceof Error&&R.message==="Empty response body")tD(R.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.Wo&&R.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,H,W));B.k7(6);break}return g.T(B,JD(m.L,t),9);case 9:N=B.Y;y=g.U(M.actionMetadata,Lj);if(E=(n=y)==null?void 0:n.playlistId)N.playlistId=E;N.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.T(B,ik(t,m.L,M,m.D,N),6);case 6:return B.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,q?[q]:void 0))}})},SL0=function(m,M){var e,I,t,Y,b,r,q,Z,F,C;
return g.p(function(R){switch(R.L){case 1:return e=q4(M),g.bf(R,2),I=g.aK(M.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.T(R,Zoy(m.L,M,m.D,(F=M.actionMetadata)==null?void 0:(C=F.offlineLoggingData)==null?void 0:C.offlineDeleteReason),5):g.T(R,JD(m.L,I),6);case 6:t=R.Y;Y=g.U(M.actionMetadata,Lj);if(r=(b=Y)==null?void 0:b.playlistId)t.playlistId=r;t.offlineDeleteReason=(q=M.actionMetadata)==null?void 0:(Z=q.offlineLoggingData)==null?void 0:Z.offlineDeleteReason;return g.T(R,ik(I,m.L,M,m.D,t),7);
case 7:if(!m.V.U("woffle_enable_main_downloads_library")){R.k7(5);break}return g.T(R,UUl(m.L,M.entityKey),5);case 5:g.ru(R,3);break;case 2:return g.qZ(R),R.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e))}})},yXT=function(m,M,e,I,t){var Y,b,r,q,Z,F;
return g.p(function(C){switch(C.L){case 1:if(Y=I){C.k7(2);break}return g.T(C,STu([M]),3);case 3:b=C.Y,Y=b[0];case 2:return g.T(C,EGT(m,Y,e,t),4);case 4:r=C.Y;q=r.mainVideoEntity;Z=r.channelEntity;g.bf(C,5);var R=k4(q.thumbnail),H=k4(Z.avatar);return g.T(C,jE(R.concat(H)),7);case 7:g.ru(C,0);break;case 5:F=g.qZ(C),F instanceof Error&&F.message==="Failed to fetch"&&tD(F.message),g.Yd(C)}})},EGT=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R,H,W,N,y;
return g.p(function(n){switch(n.L){case 1:e||(e=Date.now().toString());Y=(t=M.channel)==null?void 0:t.offlineChannelData;b={id:g.db(M.videoId,"ytMainChannelEntity"),channelId:Y.channelId,title:Y.title,avatar:Y.thumbnail};r={key:g.db(M.videoId,"mainVideoDownloadStateEntity"),playbackData:g.db(M.videoId,"playbackData"),addedTimestampMillis:e,videoDownloadContextEntity:g.db(M.videoId,"videoDownloadContextEntity")};q={key:g.db(M.videoId,"videoPlaybackPositionEntity"),videoId:M.videoId,lastPlaybackPositionSeconds:"0"};
m.V.U("html5_offline_playback_position_sync")&&(Z={playbackPosition:q.key});F=g.db(M.videoId,"mainVideoEntity");C={key:F,videoId:M.videoId,title:M.title,thumbnail:M.thumbnail,localizedStrings:{viewCount:M.shortViewCountText},userState:Z,lengthSeconds:M.lengthSeconds?Number(M.lengthSeconds):void 0,publishedTimestampMillis:M.publishedTimestamp?(Number(M.publishedTimestamp)*1E3).toString():void 0,formattedDescription:M.description,owner:b.id,downloadState:r.key};if(!m.V.U("woffle_enable_main_downloads_library")||
!I){n.k7(2);break}return g.T(n,WNs(m.L,[F]),3);case 3:if(W=n.Y)R=W.mainDownloadsLibraryEntity,H=W.mainDownloadsListEntity;case 2:return y=Mny,N={key:g.db(M.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Xf(r,y,N),g.T(n,Ll(m.L,{mode:"readwrite",uS:!0},function(E){var B=G2(E,b,"ytMainChannelEntity"),w=G2(E,r,"mainVideoDownloadStateEntity"),x=G2(E,C,"mainVideoEntity");B=[B,w,x];m.V.U("html5_offline_playback_position_sync")&&(w=G2(E,q,"videoPlaybackPositionEntity"),
B.push(w));R&&(w=G2(E,R,"mainDownloadsLibraryEntity"),B.push(w));H&&(w=G2(E,H,"mainDownloadsListEntity"),B.push(w));N&&(E=G2(E,N,"downloadStatusEntity"),B.push(E));return g.iR.all(B)}),4);
case 4:return n.return({mainVideoEntity:C,channelEntity:b})}})},nG9=function(m,M,e){this.L=m;
this.V=M;this.D=e},BSK=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm;
return g.p(function(j$){switch(j$.L){case 1:return e=q4(M),I=[],g.T(j$,pl.getInstance(),2);case 2:t=j$.Y;if(!t){j$.k7(3);break}return g.T(j$,t.get("sdois"),4);case 4:return Y=j$.Y,g.T(j$,(r=t)==null?void 0:r.get("lmqf"),5);case 5:b=j$.Y;case 3:g.bf(j$,6);if(Y===void 0)throw Error("prefStorage or opt-in state is undefined");q=[];if(Y){j$.k7(8);break}return g.T(j$,Rdl(m.L),9);case 9:q=j$.Y,q.reverse();case 8:if(!q.length){j$.k7(10);break}Z=g.P(q);F=Z.next();case 11:if(F.done){j$.k7(10);break}C=F.value;
if(!C){j$.k7(12);break}R=g.aK(C).entityId;return g.T(j$,JD(m.L,R),14);case 14:return H=j$.Y,H.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.T(j$,ik(R,m.L,{entityKey:C,actionType:M.actionType},m.D,H),12);case 12:F=Z.next();j$.k7(11);break;case 10:return g.T(j$,hdK(Y,(W=b)!=null?W:"SD"),16);case 16:return N=j$.Y,g.T(j$,FNf(N),17);case 17:y=Ho9(N);if(!m.V.U("woffle_enable_main_downloads_library")){j$.k7(18);break}if(Y){j$.k7(19);break}return g.T(j$,UUl(m.L,g.o4),19);case 19:return g.T(j$,
krS(m.L,[g.o4]),18);case 18:if((n=y)==null?0:n.length)for(E=g.P(y),B=E.next();!B.done;B=E.next())if(x=w=B.value,l=x.actionType,Mw=x.entityKey,e$=x.actionMetadata,l&&Mw&&e$&&!g.U(e$,PVC)){l==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(e$.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Id=g.U(w.actionMetadata,Lj))Id.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",w.actionMetadata=Object.assign({},w.actionMetadata,{mainVideoEntityActionMetadata:Id});I.push(w)}g.ru(j$,
7);break;case 6:return bW=g.qZ(j$),CO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",tm="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bW instanceof g.Wo&&bW.type==="QUOTA_EXCEEDED"&&(CO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",tm="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),j$.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,CO,tm));case 7:return j$.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,I))}})},hXC=function(){am.apply(this,
arguments);
this.nE="mainVideoEntity"},ww9=function(m,M,e){M=M===void 0?43200:M;
e=e===void 0?!0:e;var I=I===void 0?!1:I;var t,Y,b;return g.p(function(r){switch(r.L){case 1:if(!m.X.xj())return r.return([]);t=[];g.bf(r,2);return g.T(r,P1f(M,e,I),4);case 4:t=r.Y;g.ru(r,3);break;case 2:Y=g.qZ(r),Y instanceof Error&&Y.message==="No data"||Y instanceof Error&&Y.message==="Empty response body"&&tD(Y.message);case 3:return b=qLC(m,t,e,"mainPlaylistEntity"),r.return(b)}})},oGC=function(m,M,e,I){I=I===void 0?!1:I;
var t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E;return g.p(function(B){switch(B.L){case 1:return t=[],g.T(B,BP9(),2);case 2:return(Y=B.Y)||I?g.T(B,w90(M,e),3):B.return([]);case 3:b=B.Y;if((r=b)==null||!r.length)return B.return([]);q={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Z=g.P(b);F=Z.next();case 4:if(F.done){B.k7(6);break}R=C=F.value;H=R.actionType;W=R.entityKey;N=R.actionMetadata;if(!(H&&W&&N)||g.U(N,PVC)){B.k7(5);break}H==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(N.offlineLoggingData=
q);y=g.aK(W);n=y.entityId;return g.T(B,dp(m,[n],"mainVideoEntity",H,N),8);case 8:E=B.Y,t=t.concat(E);case 5:F=Z.next();B.k7(4);break;case 6:return B.return(t)}})},zXy=function(m,M){this.L=m;
this.D=M},Xws=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n;
return g.p(function(E){switch(E.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,Y=[],g.bf(E,2),g.T(E,TSC(m,t),4);case 4:Y=E.Y;if((b=Y)==null||!b.length){E.k7(5);break}return g.T(E,ioT(m.L,M.entityKey),5);case 5:g.ru(E,3);break;case 2:return r=g.qZ(E),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.Wo&&r.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
E.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,q,Z));case 3:return F=[],g.T(E,ed9(m.L,"musicTrack",Y),7);case 7:Y=E.Y;if(Y.length)for(C=g.P(Y),R=C.next();!R.done;R=C.next())if(H=R.value,W=H.offlineVideoData,N=void 0,(N=W)==null?0:N.videoId)y=void 0,n=Number(((y=M.actionMetadata)==null?void 0:y.priority)||0)+1,F.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",n,v6,Ey(M,W,t)));return E.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,F))}})},
pwT=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8,n6,J,ms,jM,rw,dw,q9,KO,es,u2,u,c,f,z,d,s7,L,G,X,P1;
return g.p(function(B1){switch(B1.L){case 1:return e=q4(M),I=M.entityKey,t=g.aK(I).entityId,Y=[],b=!1,t==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.T(B1,Kl(m.L,"musicAlbumRelease"),5)):g.T(B1,gC(m.L,I,"musicAlbumRelease"),4);case 4:(r=B1.Y)&&Y.push(r);B1.k7(3);break;case 5:Y=B1.Y;case 3:if((q=Y)==null||!q.length)return B1.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));if(b){Z=[];F=g.P(Y);for(C=F.next();!C.done;C=F.next())R=C.value,H=g.aK(R.id).entityId,Z.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
H,"musicAlbumRelease",0,v6));return B1.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,Z))}W=[];N=Y[0];y=void 0;if(!N.downloadMetadata){B1.k7(6);break}return g.T(B1,gC(m.L,N.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:n=B1.Y,y=Number((B=(E=n)==null?void 0:E.addedTimestampMillis)!=null?B:"0")/1E3;case 6:return g.bf(B1,8),g.T(B1,TSC(m,t,(w=y)==null?void 0:w.toString()),10);case 10:W=B1.Y;g.ru(B1,9);break;case 8:x=g.qZ(B1);if(!(x instanceof Error&&x.message===
"No data")){if(x instanceof Error&&x.message==="Empty response body")tD(x.message);else return l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Mw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.Wo&&x.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Mw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B1.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,l,Mw));B1.k7(9);break}return g.T(B1,uk(t,"musicAlbumRelease",
m.L,M,m.D),9);case 9:e$=[];Id=new Map;if((bW=W)==null?0:bW.length)for(CO=g.P(W),tm=CO.next();!tm.done;tm=CO.next())j$=tm.value,g8=j$.offlineVideoData,Q0=void 0,((Q0=g8)==null?0:Q0.videoId)&&Id.set(g8.videoId,g8);lW=new Map;LO=[];if((zK=N)==null?0:(L6=zK.tracks)==null?0:L6.length)for(BS=g.P(N.tracks),S=BS.next();!S.done;S=BS.next())if(K6=S.value,Ag=g.aK(K6).entityId)Id.has(Ag)?(lW.set(Ag,Id.get(Ag)),Id.delete(Ag)):LO.push(Ag);n6=Number(((r8=M.actionMetadata)==null?void 0:r8.priority)||0)+1;J=g.P(Id.entries());
for(ms=J.next();!ms.done;ms=J.next())jM=ms.value,rw=g.P(jM),dw=rw.next().value,q9=rw.next().value,KO=dw,es=q9,e$.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",KO,"musicTrack",n6,v6,Ey(M,es)));u2=g.P(lW.entries());for(u=u2.next();!u.done;u=u2.next())c=u.value,f=g.P(c),z=f.next().value,d=f.next().value,s7=z,L=d,e$.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",s7,"musicTrack",n6,v6,Ey(M,L)));G=g.P(LO);for(X=G.next();!X.done;X=G.next())P1=X.value,e$.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
P1,"musicTrack",0,v6));return B1.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,e$))}})},lyd=function(m,M){var e,I;
return g.p(function(t){switch(t.L){case 1:return e=q4(M),g.bf(t,2),I=g.aK(M.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.T(t,SE(m.L,M,m.D),5):g.T(t,uk(I,"musicAlbumRelease",m.L,M,m.D),6);case 6:return g.T(t,yo6(m.L,M.entityKey),5);case 5:g.ru(t,3);break;case 2:return g.qZ(t),t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},TSC=function(m,M,e){var I,t,Y;
return g.p(function(b){switch(b.L){case 1:return g.T(b,Ewl([M]),2);case 2:return I=b.Y,g.T(b,xMs(m,I[0],e),3);case 3:return t=b.Y,Y=k4(t.thumbnailDetails),g.T(b,jE(Y),4);case 4:return b.return(I[0].videos)}})},xMs=function(m,M,e){var I,t,Y,b,r,q,Z,F,C,R,H,W,N,y;
return g.p(function(n){if(n.L==1){I=M.additionalMetadadatas;t=void 0;if(I&&I.length>0)for(Y=g.P(I),b=Y.next();!b.done;b=Y.next())if(r=b.value,r.offlineMusicPlaylistData){t=r.offlineMusicPlaylistData;break}q=M.playlistId;Z=JoK(M);F=Z.vW;C=Z.VK;R=e?(Number(e)*1E3).toString():Date.now().toString();H=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0";W={id:g.db(q,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:C,lastModifiedTimestampMillis:H,addedTimestampMillis:R,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};N={id:g.db(q,"musicAlbumRelease"),title:M.title,audioPlaylistId:q,trackCount:M.totalVideoCount,tracks:F,downloadMetadata:W.id};t&&(N.thumbnailDetails=(y=t.albumHqThumbnail)!=null?y:t.albumArtistThumbnail,N.artistDisplayName=t.albumArtistDisplayName,N.releaseDate=t.albumReleaseDate,N.contentRating={explicitType:t.albumReleaseExplicitType},N.releaseType=t.albumReleaseType);return g.T(n,Ll(m.L,{mode:"readwrite",uS:!0},function(E){var B=G2(E,N,"musicAlbumRelease");
E=G2(E,W,"musicAlbumReleaseDownloadMetadataEntity");return g.iR.all([B,E])}),2)}return n.return(N)})},AXf=function(m,M){this.L=m;
this.D=M},$Ml=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n;
return g.p(function(E){switch(E.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,Y=[],g.bf(E,2),g.T(E,DMu(m,t),4);case 4:Y=E.Y;if((b=Y)==null||!b.length){E.k7(5);break}return g.T(E,ioT(m.L,M.entityKey),5);case 5:g.ru(E,3);break;case 2:return r=g.qZ(E),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.Wo&&r.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
E.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,q,Z));case 3:return F=[],g.T(E,ed9(m.L,"musicTrack",Y),7);case 7:Y=E.Y;if(Y.length)for(C=g.P(Y),R=C.next();!R.done;R=C.next())if(H=R.value,W=H.offlineVideoData,N=void 0,(N=W)==null?0:N.videoId)y=void 0,n=Number(((y=M.actionMetadata)==null?void 0:y.priority)||0)+1,F.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",n,gp,Ey(M,W,t)));return E.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,F))}})},
Gas=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S,K6,Ag,r8,n6,J,ms,jM,rw,dw,q9,KO,es,u2,u,c,f,z,d,s7,L,G,X,P1,B1,U7,E7,tg,uW,xt,OY,vS,nO,AS,hm,y0;
return g.p(function(xb){switch(xb.L){case 1:return e=q4(M),I=M.entityKey,t=g.aK(I).entityId,Y=[],b=!1,t==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.T(xb,Kl(m.L,"musicPlaylist"),5)):g.T(xb,gC(m.L,I,"musicPlaylist"),4);case 4:(r=xb.Y)&&Y.push(r);xb.k7(3);break;case 5:Y=xb.Y;case 3:if((q=Y)==null||!q.length)return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));Z=g.U(M.actionMetadata,fT6);C=(F=Z)==null?void 0:F.autoSync;R=[];W=H=!0;N=!1;y=void 0;if(!b&&C===!1){xb.k7(6);break}g.bf(xb,7);return g.T(xb,
ow0(0,!!C,!0,Y),9);case 9:R=xb.Y;g.ru(xb,8);break;case 7:n=g.qZ(xb);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&tD(n.message);xb.k7(8);break}return t==="!*$_ALL_ENTITIES_!*$"?g.T(xb,SE(m.L,M,m.D),8):g.T(xb,uk(t,"musicPlaylist",m.L,M,m.D),8);case 8:if(!R.length||!b&&R[0].playlistId!==t)return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));case 6:if(b){E=[];B=g.P(R);for(w=B.next();!w.done;w=B.next())x=w.value,x.upToDate||
C&&!x.shouldAutoSyncMetadata||!x.playlistId||(l={autoSync:C},E.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x.playlistId,"musicPlaylist",0,gp,{musicPlaylistEntityActionMetadata:l})));return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,E))}R.length&&(Mw=R[0],N=!!Mw.upToDate,C&&(H=(e$=Mw.shouldAutoSyncMetadata)!=null?e$:!0,W=(Id=Mw.shouldAutoSyncVideos)!=null?Id:!0,Mw.checkInSeconds&&(y=Mw.checkInSeconds)));if(N||!H)return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));bW=[];CO=Y[0];tm=void 0;if(!CO.downloadMetadata){xb.k7(15);break}return g.T(xb,gC(m.L,CO.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:j$=xb.Y,tm=Number((Q0=(g8=j$)==null?void 0:g8.addedTimestampMillis)!=null?Q0:"0")/1E3;case 15:return g.bf(xb,17),g.T(xb,DMu(m,t,(lW=tm)==null?void 0:lW.toString(),y),19);case 19:bW=xb.Y;g.ru(xb,18);break;case 17:LO=g.qZ(xb);if(!(LO instanceof Error&&LO.message==="No data")){if(LO instanceof Error&&LO.message==="Empty response body")tD(LO.message);
else return zK="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",LO instanceof g.Wo&&LO.type==="QUOTA_EXCEEDED"&&(zK="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,zK,L6));xb.k7(18);break}return g.T(xb,uk(t,"musicPlaylist",m.L,M,m.D),18);case 18:if(!W)return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e));BS=[];S=new Map;if((K6=bW)==null?0:K6.length)for(Ag=g.P(bW),r8=Ag.next();!r8.done;r8=Ag.next())n6=r8.value,J=n6.offlineVideoData,ms=void 0,((ms=J)==null?0:ms.videoId)&&S.set(J.videoId,J);jM=new Map;rw=[];if((dw=CO)==null?0:(q9=dw.tracks)==null?0:q9.length)for(KO=g.P(CO.tracks),es=KO.next();!es.done;es=KO.next())if(u2=es.value,u=g.aK(u2).entityId)S.has(u)?(jM.set(u,S.get(u)),S.delete(u)):rw.push(u);f=Number(((c=M.actionMetadata)==null?void 0:c.priority)||0)+1;z=g.P(S.entries());for(d=z.next();!d.done;d=
z.next())s7=d.value,L=g.P(s7),G=L.next().value,X=L.next().value,P1=G,B1=X,BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P1,"musicTrack",f,gp,Ey(M,B1)));U7=g.P(jM.entries());for(E7=U7.next();!E7.done;E7=U7.next())tg=E7.value,uW=g.P(tg),xt=uW.next().value,OY=uW.next().value,vS=xt,nO=OY,BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",vS,"musicTrack",f,gp,Ey(M,nO)));AS=g.P(rw);for(hm=AS.next();!hm.done;hm=AS.next())y0=hm.value,BS.push(hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",y0,"musicTrack",
0,gp));return xb.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,BS))}})},ayS=function(m,M){var e,I;
return g.p(function(t){switch(t.L){case 1:return e=q4(M),g.bf(t,2),I=g.aK(M.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.T(t,SE(m.L,M,m.D),5):g.T(t,uk(I,"musicPlaylist",m.L,M,m.D),6);case 6:return g.T(t,yo6(m.L,M.entityKey),5);case 5:g.ru(t,3);break;case 2:return g.qZ(t),t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},DMu=function(m,M,e,I){var t,Y,b;
return g.p(function(r){switch(r.L){case 1:return g.T(r,Ewl([M]),2);case 2:return t=r.Y,g.T(r,dM6(m,t[0],e,I),3);case 3:return Y=r.Y,b=k4(Y.thumbnailDetails),g.T(r,jE(b),4);case 4:return r.return(t[0].videos)}})},dM6=function(m,M,e,I){var t,Y,b,r,q,Z,F,C,R;
return g.p(function(H){return H.L==1?(t=M.playlistId,Y=JoK(M),b=Y.vW,r=Y.VK,q=e?(Number(e)*1E3).toString():Date.now().toString(),Z=M.lastModifiedTimestamp?(Number(M.lastModifiedTimestamp)*1E3).toString():"0",F={id:g.db(t,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:Z,addedTimestampMillis:q,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},C={id:g.db(t,"musicPlaylist"),title:M.title,playlistId:t,thumbnailDetails:M.thumbnail,visibility:OSC(M),trackCount:M.totalVideoCount,
tracks:b,downloadMetadata:F.id},I&&(((R=C)==null?0:R.entityMetadata)?C.entityMetadata.nextAutoRefreshIntervalSeconds=String(I):C&&(C.entityMetadata={nextAutoRefreshIntervalSeconds:String(I)})),g.T(H,Ll(m.L,{mode:"readwrite",uS:!0},function(W){var N=G2(W,C,"musicPlaylist");W=G2(W,F,"musicPlaylistDownloadMetadataEntity");return g.iR.all([N,W])}),2)):H.return(C)})},OSC=function(m){switch(m.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},LOs=function(m,M){this.L=m;
this.D=M},mzl=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W;
return g.p(function(N){switch(N.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,Y=g.U(M.actionMetadata,vGs),g.bf(N,2),g.T(N,gGu(m,t,void 0,(b=Y)==null?void 0:b.track,(r=Y)==null?void 0:r.albumRelease),4);case 4:if((q=Y)==null?0:q.playlistId){N.k7(5);break}return g.T(N,ioT(m.L,M.entityKey),5);case 5:g.ru(N,3);break;case 2:return Z=g.qZ(N),F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.Wo&&Z.type==="QUOTA_EXCEEDED"&&
(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),N.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,F,C));case 3:H=Number(((R=M.actionMetadata)==null?void 0:R.priority)||0)+1;var y=(y=g.U(M.actionMetadata,vGs))?{playbackDataActionMetadata:{maximumDownloadQuality:y.maximumDownloadQuality}}:void 0;W=hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t,"playbackData",H,KOS,y);return N.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e,[W]))}})},Mx9=function(m,M){var e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y;
return g.p(function(n){switch(n.L){case 1:return e=q4(M),I=g.aK(M.entityKey),t=I.entityId,g.T(n,gC(m.L,M.entityKey,"musicTrack"),2);case 2:Y=n.Y;if(!Y){b=void 0;n.k7(3);break}return g.T(n,gC(m.L,Y.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:b=n.Y;case 3:r=b;if(!Y||!r)return n.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e));Z=g.U(M.actionMetadata,vGs);g.bf(n,5);return g.T(n,gGu(m,t,r.addedTimestampMillis,(F=Z)==null?void 0:F.track,(C=Z)==null?void 0:C.albumRelease),
7);case 7:H=Number(((R=M.actionMetadata)==null?void 0:R.priority)||0)+1;q=hD("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t,"playbackData",H,KOS);g.ru(n,6);break;case 5:W=g.qZ(n);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")tD(W.message);else return N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.Wo&&W.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,N,y));n.k7(6);break}return g.T(n,fj(t,m.L,M,m.D),6);case 6:return n.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",e,q?[q]:void 0))}})},el0=function(m,M){var e,I;
return g.p(function(t){switch(t.L){case 1:return e=q4(M),g.bf(t,2),I=g.aK(M.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.T(t,SE(m.L,M,m.D),5):g.T(t,fj(I,m.L,M,m.D),6);case 6:return g.T(t,yo6(m.L,M.entityKey),5);case 5:g.ru(t,3);break;case 2:return g.qZ(t),t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",e,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new wp("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
e))}})},gGu=function(m,M,e,I,t){var Y,b,r,q,Z,F;
return g.p(function(C){switch(C.L){case 1:if(Y=I){C.k7(2);break}return g.T(C,STu([M]),3);case 3:b=C.Y,r=b[0],Y=jw0(r);case 2:return g.T(C,IuT(m,Y,M,t,e),4);case 4:q=C.Y;Z=q.musicTrackEntity;F=q.ox;var R=k4(Z.thumbnailDetails),H=[];F&&(H=k4(F.thumbnailDetails));return g.T(C,jE(R.concat(H)),0)}})},IuT=function(m,M,e,I,t){var Y;
return g.p(function(b){return b.L==1?(t||(t=Date.now().toString()),Y={id:g.db(e,"musicTrackDownloadMetadataEntity"),playbackData:g.db(e,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.db(e,"videoDownloadContextEntity")},I&&(M.albumRelease=I.id),g.T(b,Ll(m.L,{mode:"readwrite",uS:!0},function(r){var q=[],Z=G2(r,Y,"musicTrackDownloadMetadataEntity");q.push(Z);Z=G2(r,M,"musicTrack");q.push(Z);I&&(r=G2(r,I,"musicAlbumRelease"),q.push(r));return g.iR.all(q)}),2)):b.L!=3?g.T(b,H6(e,"musicTrackDownloadMetadataEntity",
m.L,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):b.return({musicTrackEntity:M,
ox:I})})},Kj=function(){am.apply(this,arguments);
this.nE="musicTrack"},tx0=function(m,M,e){M=M===void 0?43200:M;
e=e===void 0?!0:e;var I=I===void 0?!1:I;var t,Y;return g.p(function(b){switch(b.L){case 1:if(!m.X.xj())return b.return([]);t=[];g.bf(b,2);return g.T(b,ow0(M,e,I),4);case 4:t=b.Y;g.ru(b,3);break;case 2:g.qZ(b);case 3:return Y=qLC(m,t,e,"musicPlaylist"),b.return(Y)}})},YnT=function(){g.Fh.apply(this,arguments);
var m=this;this.events=new g.CV(this);this.V=this.player.K();this.ZL={qsu:function(){return m.L},
Kx:function(){return m.Kx()},
FG:function(M){return m.FG(M)}}},ba9=function(m){var M;
m=g.U((M=m.getWatchNextResponse())==null?void 0:M.currentVideoEndpoint,g.CT);if(m==null?0:m.playlistId)var e=m.playlistId;return e},QSf=function(m,M){var e,I,t,Y;
return g.p(function(b){if(b.L==1){e=M.clientPlaybackNonce;I={cpn:e,offlineSourceVisualElement:g.VU(M.Y7||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};M.Y&&(I.videoFmt=Number(M.Y.itag));M.B&&(I.audioFmt=Number(M.B.itag));if((t=ba9(M))&&M.videoId){var r=M.videoId;r=t!=="PPSV"?Promise.resolve(!1):m.L.CT(r);b=g.T(b,r,3)}else b=b.k7(2);return b}b.L!=2&&(Y=b.Y)&&(I.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");m.Y=e;g.kr("offlinePlaybackStarted",I);g.Yd(b)})};
g.TS.prototype.sy=g.Xt(41,function(m){return this.app.sy(m)});
g.WN.prototype.sy=g.Xt(40,function(m){return g.Y$d(this,9,m)});
g.V(T2,z2);g.$b.Object.defineProperties(T2.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.L.entityMetadata},
set:function(m){this.L.entityMetadata=m}}});
g.V(dol,T2);dol.prototype.Y=function(){return[]};
g.V(O0g,T2);O0g.prototype.Y=function(){return[]};
g.V(Lld,T2);Lld.prototype.Y=function(){return[]};
g.V(vC9,T2);vC9.prototype.Y=function(){return[]};
g.V(gCg,T2);gCg.prototype.Y=function(){return[]};
g.V(Klg,T2);Klg.prototype.Y=function(){var m=[];this.L.alternateChannel&&m.push(this.L.alternateChannel);this.L.alternateChannelList&&m.push.apply(m,g.h(this.L.alternateChannelList));this.L.oneofChannelEntity&&m.push(this.L.oneofChannelEntity);return[].concat(g.h(new Set(m)))};
g.V(mPd,T2);mPd.prototype.Y=function(){var m=[];this.L.entryCollection&&m.push(this.L.entryCollection);return[].concat(g.h(new Set(m)))};
g.V(M6s,z2);M6s.prototype.Y=function(){var m=[];this.L.video&&m.push(this.L.video);return[].concat(g.h(new Set(m)))};
g.V(e4C,T2);e4C.prototype.Y=function(){var m=[];this.L.parentPlaylist&&m.push(this.L.parentPlaylist);if(this.L.entries)for(var M=g.P(this.L.entries),e=M.next();!e.done;e=M.next())m.push.apply(m,g.h((new M6s(e.value)).Y()));return[].concat(g.h(new Set(m)))};
g.V(Isu,T2);Isu.prototype.Y=function(){var m=[];this.L.descriptionEntity&&m.push(this.L.descriptionEntity);this.L.creators&&m.push.apply(m,g.h(this.L.creators));this.L.theBiggestFan&&m.push(this.L.theBiggestFan);return[].concat(g.h(new Set(m)))};
g.V(t6T,T2);t6T.prototype.Y=function(){return[]};
g.V(YZK,T2);YZK.prototype.Y=function(){return[]};
g.V(bhK,T2);bhK.prototype.Y=function(){return[]};
g.V(QGS,T2);QGS.prototype.Y=function(){return[]};
g.V(sGg,T2);sGg.prototype.Y=function(){return[]};
g.V(rE9,T2);rE9.prototype.Y=function(){return[]};
g.V(qZ6,T2);qZ6.prototype.Y=function(){return[]};
g.V(Zh6,T2);Zh6.prototype.Y=function(){return[]};
g.V(Fgl,T2);Fgl.prototype.Y=function(){return[]};
g.V(CpT,T2);CpT.prototype.Y=function(){var m=[];this.L.downloadsList&&m.push(this.L.downloadsList);this.L.smartDownloadsList&&m.push(this.L.smartDownloadsList);this.L.recommendedDownloadsList&&m.push(this.L.recommendedDownloadsList);this.L.refresh&&m.push(this.L.refresh);return[].concat(g.h(new Set(m)))};
g.V(HhC,z2);HhC.prototype.Y=function(){var m=[];this.L.video&&m.push(this.L.video);this.L.playlist&&m.push(this.L.playlist);this.L.videoItem&&m.push(this.L.videoItem);this.L.playlistItem&&m.push(this.L.playlistItem);return[].concat(g.h(new Set(m)))};
g.V(R4Z,T2);R4Z.prototype.Y=function(){var m=[];this.L.refresh&&m.push(this.L.refresh);if(this.L.downloads)for(var M=g.P(this.L.downloads),e=M.next();!e.done;e=M.next())m.push.apply(m,g.h((new HhC(e.value)).Y()));return[].concat(g.h(new Set(m)))};
g.V(Wgd,T2);Wgd.prototype.Y=function(){var m=[];this.L.localImageEntities&&m.push.apply(m,g.h(this.L.localImageEntities));return[].concat(g.h(new Set(m)))};
g.V(kLT,T2);kLT.prototype.Y=function(){var m=[];this.L.playbackData&&m.push(this.L.playbackData);this.L.localImageEntities&&m.push.apply(m,g.h(this.L.localImageEntities));this.L.videoDownloadContextEntity&&m.push(this.L.videoDownloadContextEntity);return[].concat(g.h(new Set(m)))};
g.V(UPS,T2);UPS.prototype.Y=function(){return[]};
g.V(V6u,T2);V6u.prototype.Y=function(){var m=[];this.L.fakeChildren&&m.push.apply(m,g.h(this.L.fakeChildren));return[].concat(g.h(new Set(m)))};
g.V(NL6,T2);NL6.prototype.Y=function(){var m=[];this.L.video&&m.push(this.L.video);this.L.playbackData&&m.push(this.L.playbackData);this.L.offlineVideoPolicy&&m.push(this.L.offlineVideoPolicy);return[].concat(g.h(new Set(m)))};
g.V(cEu,T2);cEu.prototype.Y=function(){return[]};
g.V(jGS,T2);jGS.prototype.Y=function(){var m=[];this.L.channelOwner&&m.push(this.L.channelOwner);this.L.videos&&m.push.apply(m,g.h(this.L.videos));this.L.collaboratorChannels&&m.push.apply(m,g.h(this.L.collaboratorChannels));this.L.downloadState&&m.push(this.L.downloadState);this.L.refresh&&m.push(this.L.refresh);return[].concat(g.h(new Set(m)))};
g.V(ihT,T2);ihT.prototype.Y=function(){var m=[];this.L.video&&m.push(this.L.video);this.L.channelContributor&&m.push(this.L.channelContributor);return[].concat(g.h(new Set(m)))};
g.V(yEd,z2);yEd.prototype.Y=function(){var m=[];this.L.localImageEntities&&m.push.apply(m,g.h(this.L.localImageEntities));this.L.videoDownloadContextEntity&&m.push(this.L.videoDownloadContextEntity);return[].concat(g.h(new Set(m)))};
g.V(JEl,z2);JEl.prototype.Y=function(){var m=[];this.L.recommendedVideoMetadata&&m.push.apply(m,g.h((new yEd(this.L.recommendedVideoMetadata)).Y()));return[].concat(g.h(new Set(m)))};
g.V(fsC,z2);fsC.prototype.Y=function(){var m=[];this.L.playbackPosition&&m.push(this.L.playbackPosition);return[].concat(g.h(new Set(m)))};
g.V(uA6,T2);uA6.prototype.Y=function(){var m=[];this.L.owner&&m.push(this.L.owner);this.L.downloadState&&m.push(this.L.downloadState);this.L.userState&&m.push.apply(m,g.h((new fsC(this.L.userState)).Y()));this.L.additionalMetadata&&m.push.apply(m,g.h((new JEl(this.L.additionalMetadata)).Y()));return[].concat(g.h(new Set(m)))};
g.V(SZC,T2);SZC.prototype.Y=function(){var m=[];this.L.userChannelDetails&&m.push(this.L.userChannelDetails);return[].concat(g.h(new Set(m)))};
g.V(End,T2);End.prototype.Y=function(){var m=[];this.L.channelOwner&&m.push(this.L.channelOwner);this.L.playbackPosition&&m.push(this.L.playbackPosition);this.L.localImageEntities&&m.push.apply(m,g.h(this.L.localImageEntities));this.L.downloadStatus&&m.push(this.L.downloadStatus);return[].concat(g.h(new Set(m)))};
g.V(nnK,T2);nnK.prototype.Y=function(){return[]};
g.V(PpK,T2);PpK.prototype.Y=function(){return[]};
g.V(BLS,T2);BLS.prototype.Y=function(){return[]};
g.V(h40,T2);h40.prototype.Y=function(){return[]};
g.V(wmu,T2);wmu.prototype.Y=function(){return[]};
g.V(onu,T2);onu.prototype.Y=function(){return[]};
g.V(z4C,T2);z4C.prototype.Y=function(){return[]};
g.V(TLC,T2);TLC.prototype.Y=function(){return[]};
g.V(Xm6,T2);Xm6.prototype.Y=function(){return[]};
g.V(pmy,T2);pmy.prototype.Y=function(){return[]};
g.V(ls6,T2);ls6.prototype.Y=function(){return[]};
g.V(xPd,T2);xPd.prototype.Y=function(){return[]};
g.V(AEZ,T2);AEZ.prototype.Y=function(){return[]};
g.V(DPK,T2);DPK.prototype.Y=function(){var m=[];this.L.compositeSourceKeys&&m.push.apply(m,g.h(this.L.compositeSourceKeys));return[].concat(g.h(new Set(m)))};
g.V($Pu,T2);$Pu.prototype.Y=function(){var m=[];this.L.trackDownloadMetadatas&&m.push.apply(m,g.h(this.L.trackDownloadMetadatas));return[].concat(g.h(new Set(m)))};
g.V(GL6,T2);
GL6.prototype.Y=function(){var m=[];this.L.downloadedTracks&&m.push.apply(m,g.h(this.L.downloadedTracks));this.L.smartDownloadedTracks&&m.push.apply(m,g.h(this.L.smartDownloadedTracks));this.L.downloadedEpisodes&&m.push.apply(m,g.h(this.L.downloadedEpisodes));this.L.downloadedAlbumReleases&&m.push.apply(m,g.h(this.L.downloadedAlbumReleases));this.L.smartDownloadedAlbumReleases&&m.push.apply(m,g.h(this.L.smartDownloadedAlbumReleases));this.L.downloadedPlaylists&&m.push.apply(m,g.h(this.L.downloadedPlaylists));this.L.smartDownloadedPlaylists&&
m.push.apply(m,g.h(this.L.smartDownloadedPlaylists));this.L.metadataOnlyTracks&&m.push.apply(m,g.h(this.L.metadataOnlyTracks));return[].concat(g.h(new Set(m)))};
g.V(asS,T2);asS.prototype.Y=function(){var m=[];this.L.trackDownloadMetadatas&&m.push.apply(m,g.h(this.L.trackDownloadMetadatas));return[].concat(g.h(new Set(m)))};
g.V(dPf,T2);dPf.prototype.Y=function(){var m=[];this.L.playbackData&&m.push(this.L.playbackData);this.L.localImageEntities&&m.push.apply(m,g.h(this.L.localImageEntities));this.L.videoDownloadContextEntity&&m.push(this.L.videoDownloadContextEntity);return[].concat(g.h(new Set(m)))};
g.V(Ohu,T2);Ohu.prototype.Y=function(){var m=[];this.L.musicLibraryStatusEntity&&m.push(this.L.musicLibraryStatusEntity);this.L.primaryArtists&&m.push.apply(m,g.h(this.L.primaryArtists));this.L.details&&m.push(this.L.details);this.L.userDetails&&m.push(this.L.userDetails);this.L.tracks&&m.push.apply(m,g.h(this.L.tracks));this.L.share&&m.push(this.L.share);this.L.downloadMetadata&&m.push(this.L.downloadMetadata);this.L.refresh&&m.push(this.L.refresh);return[].concat(g.h(new Set(m)))};
g.V(LgC,T2);LgC.prototype.Y=function(){var m=[];this.L.albumRelease&&m.push(this.L.albumRelease);this.L.tracks&&m.push.apply(m,g.h(this.L.tracks));return[].concat(g.h(new Set(m)))};
g.V(vnT,T2);vnT.prototype.Y=function(){var m=[];this.L.albumRelease&&m.push(this.L.albumRelease);return[].concat(g.h(new Set(m)))};
g.V(gnS,T2);gnS.prototype.Y=function(){var m=[];this.L.details&&m.push(this.L.details);this.L.userDetails&&m.push(this.L.userDetails);return[].concat(g.h(new Set(m)))};
g.V(Kgf,T2);Kgf.prototype.Y=function(){var m=[];this.L.parentArtist&&m.push(this.L.parentArtist);return[].concat(g.h(new Set(m)))};
g.V(mbT,T2);mbT.prototype.Y=function(){var m=[];this.L.parentArtist&&m.push(this.L.parentArtist);return[].concat(g.h(new Set(m)))};
g.V(MqT,T2);MqT.prototype.Y=function(){return[]};
g.V(eWC,T2);eWC.prototype.Y=function(){return[]};
g.V(IFC,z2);IFC.prototype.Y=function(){var m=[];this.L.creatorEntity&&m.push(this.L.creatorEntity);return[].concat(g.h(new Set(m)))};
g.V(tq6,T2);
tq6.prototype.Y=function(){var m=[];this.L.tracks&&m.push.apply(m,g.h(this.L.tracks));this.L.refresh&&m.push(this.L.refresh);this.L.musicLibraryStatusEntity&&m.push(this.L.musicLibraryStatusEntity);this.L.details&&m.push(this.L.details);this.L.downloadMetadata&&m.push(this.L.downloadMetadata);this.L.sideloadMetadata&&m.push(this.L.sideloadMetadata);this.L.userDetails&&m.push(this.L.userDetails);this.L.entryCollection&&m.push(this.L.entryCollection);this.L.share&&m.push(this.L.share);this.L.podcastShowAdditionalMetadata&&m.push.apply(m,
g.h((new IFC(this.L.podcastShowAdditionalMetadata)).Y()));return[].concat(g.h(new Set(m)))};
g.V(YSl,T2);YSl.prototype.Y=function(){return[]};
g.V(bUs,T2);
bUs.prototype.Y=function(){var m=[];this.L.musicLibraryStatusEntity&&m.push(this.L.musicLibraryStatusEntity);this.L.artists&&m.push.apply(m,g.h(this.L.artists));this.L.audioModeVersion&&m.push(this.L.audioModeVersion);this.L.videoModeVersion&&m.push(this.L.videoModeVersion);this.L.userDetails&&m.push(this.L.userDetails);this.L.details&&m.push(this.L.details);this.L.albumRelease&&m.push(this.L.albumRelease);this.L.share&&m.push(this.L.share);this.L.libraryEdit&&m.push(this.L.libraryEdit);this.L.downloadMetadata&&
m.push(this.L.downloadMetadata);this.L.playbackPosition&&m.push(this.L.playbackPosition);this.L.lyrics&&m.push(this.L.lyrics);return[].concat(g.h(new Set(m)))};
g.V(Q5u,T2);Q5u.prototype.Y=function(){var m=[];this.L.parentTrack&&m.push(this.L.parentTrack);return[].concat(g.h(new Set(m)))};
g.V(s5s,T2);s5s.prototype.Y=function(){var m=[];this.L.parentTrack&&m.push(this.L.parentTrack);return[].concat(g.h(new Set(m)))};
g.V(r5f,T2);r5f.prototype.Y=function(){return[]};
g.V(qSC,T2);qSC.prototype.Y=function(){return[]};
g.V(ZUu,T2);ZUu.prototype.Y=function(){return[]};
g.V(FU0,T2);FU0.prototype.Y=function(){return[]};
g.V(CCT,T2);CCT.prototype.Y=function(){var m=[];this.L.transfer&&m.push(this.L.transfer);this.L.adsPlaybackData&&m.push.apply(m,g.h(this.L.adsPlaybackData));this.L.drmLicense&&m.push(this.L.drmLicense);this.L.offlineVideoPolicy&&m.push(this.L.offlineVideoPolicy);this.L.videoDownloadContextEntity&&m.push(this.L.videoDownloadContextEntity);return[].concat(g.h(new Set(m)))};
g.V(HUg,T2);HUg.prototype.Y=function(){return[]};
g.V(RWu,T2);RWu.prototype.Y=function(){var m=[];this.L.offlineVideoStreams&&m.push.apply(m,g.h(this.L.offlineVideoStreams));this.L.captionTrack&&m.push.apply(m,g.h(this.L.captionTrack));return[].concat(g.h(new Set(m)))};
g.V(WUS,T2);WUS.prototype.Y=function(){return[]};
g.V(kUg,T2);kUg.prototype.Y=function(){return[]};
g.V(Ub9,T2);Ub9.prototype.Y=function(){return[]};
g.V(VqT,T2);VqT.prototype.Y=function(){return[]};
g.V(NT6,T2);NT6.prototype.Y=function(){return[]};
g.V(c5S,T2);c5S.prototype.Y=function(){return[]};
g.V(j5Z,T2);j5Z.prototype.Y=function(){return[]};
g.V(iU6,T2);iU6.prototype.Y=function(){return[]};
g.V(y56,T2);y56.prototype.Y=function(){return[]};
g.V(J5l,T2);J5l.prototype.Y=function(){return[]};
g.V(fFZ,T2);fFZ.prototype.Y=function(){return[]};
g.V(uxT,T2);uxT.prototype.Y=function(){return[]};
g.V(SSy,T2);SSy.prototype.Y=function(){return[]};
g.V(EZ0,T2);EZ0.prototype.Y=function(){return[]};
g.V(nZy,T2);nZy.prototype.Y=function(){return[]};
g.V(PCd,T2);PCd.prototype.Y=function(){return[]};
g.V(BT6,T2);BT6.prototype.Y=function(){return[]};
g.V(hWl,T2);hWl.prototype.Y=function(){return[]};
g.V(w_T,T2);w_T.prototype.Y=function(){return[]};
g.V(oZy,T2);oZy.prototype.Y=function(){return[]};
g.V(zWK,T2);zWK.prototype.Y=function(){return[]};
g.V(TTu,T2);TTu.prototype.Y=function(){return[]};
var zds=["browse","music/browse","streaming_browse","unplugged/browse"],xU0=["offline/playlist_sync_check"],u8l=["offline"],TPs=["offline/offline_video_playback_position_sync"],p9f=["offline/get_playback_data_entity"],XY;pl.getInstance=function(){return g.p(function(m){return m.return(new Promise(function(M){g.ej().then(function(e){e?(pl.instance||(pl.instance=new pl(e)),M(pl.instance)):M(void 0)})}))})};
pl.prototype.get=function(m){var M=this,e,I,t;return g.p(function(Y){if(Y.L==1)return g.T(Y,xb0(M.token),2);if(Y.L!=3)return e=Y.Y,g.T(Y,e.get("prefs",m),3);I=Y.Y;if(!I)return Y.return();t=(0,g.uR)();return I.expirationTimestampMs<=t?Y.return():Y.return(I.value)})};
pl.prototype.set=function(m,M,e){e=e===void 0?31536E3:e;var I=this,t,Y,b;return g.p(function(r){if(r.L==1)return t=(0,g.uR)(),Y={key:m,value:M,expirationTimestampMs:t+e*1E3},g.T(r,xb0(I.token),2);b=r.Y;return g.T(r,g.wD(b,"prefs",Y),0)})};
pl.prototype.remove=function(m){var M=this,e;return g.p(function(I){if(I.L==1)return g.T(I,xb0(M.token),2);e=I.Y;return g.T(I,e.delete("prefs",m),0)})};
g.V(lN,g.fO);g.V(x9,aFl);x9.prototype.D=function(m,M){M=OUy(M);m=(new TextEncoder).encode(JSON.stringify(m));return this.L.encrypt(m,M)};
x9.prototype.Y=function(m,M){if(!(m instanceof Uint8Array))throw A5f(1);var e=new TextDecoder;M=OUy(M);m=this.L.decrypt(m,M);return JSON.parse(e.decode(m))};
var LUu={accountLinkStatusEntity:bhK,booleanEntity:vC9,buttonEntity:nZy,captionTrack:r5f,channelHandle:dol,chipEntity:j5Z,commerceAcquisitionClientPayloadEntity:BT6,commerceCartListEntity:hWl,compositeSourceEntity:AEZ,multiviewStagingEntity:DPK,contextNoteFeedEntityPayload:O0g,contextNoteUserRatingEntityPayload:Lld,continuationTokenEntity:cEu,downloadQualityPickerEntity:qZ6,downloadsPageRefreshTokenEntity:Fgl,downloadsPageViewConfigurationEntity:nnK,downloadStatusEntity:Zh6,dismissState:iU6,sfvAudioItemCurrentlyPlayingEntity:VqT,
emojiFountainDataEntity:SSy,emojiCustomizationSetEntity:uxT,fakeChannel:Klg,fakePlaylist:mPd,fakePlaylistEntryCollection:e4C,fakeVideo:Isu,fakeVideoDescription:t6T,featuredProductsEntity:pmy,flowStateEntity:YZK,iconBadgeEntity:w_T,interstitialInteractionStateEntity:sGg,likeButtonAnimationEntity:PpK,liveChatPollStateEntity:rE9,dataFreshnessEntity:fFZ,liveViewerLeaderboardChatEntryPointStateEntity:kUg,liveViewerLeaderboardPointsEntity:Ub9,liveReactionsDataEntity:EZ0,logoEntity:QGS,macroMarkerEntity:BLS,
mainDownloadsLibraryEntity:CpT,mainDownloadsListEntity:R4Z,mainPlaylistDownloadStateEntity:Wgd,mainPlaylistEntity:jGS,mainPlaylistVideoEntity:ihT,mainVideoDownloadStateEntity:kLT,mainVideoEntity:uA6,markersEngagementPanelSyncEntity:h40,markersVisibilityOverrideEntity:wmu,musicAlbumReleaseDetail:LgC,musicAlbumReleaseDownloadMetadataEntity:$Pu,musicAlbumRelease:Ohu,musicAlbumReleaseUserDetail:vnT,musicArtistDetail:Kgf,musicArtist:gnS,musicArtistUserDetail:mbT,musicDownloadsLibraryEntity:GL6,musicLibraryEdit:MqT,
musicLibraryStatusEntity:eWC,musicPlaylist:tq6,musicPlaylistDownloadMetadataEntity:asS,musicShare:YSl,musicTrackDetail:Q5u,musicTrackDownloadMetadataEntity:dPf,musicTrack:bUs,musicTrackUserDetail:s5s,offlineOrchestrationActionWrapperEntity:qSC,offlineVideoPolicy:ZUu,offlineVideoStreams:FU0,offlineabilityEntity:UPS,orchestrationWebSamplingEntity:V6u,pageHeaderEntity:y56,pdpStateEntity:oZy,pinnedProductEntity:ls6,playbackData:CCT,playerStateEntity:onu,quantityIncrementerEntity:zWK,refresh:HUg,saveToPlaylistListEntity:NT6,
selectedChipIndexEntityPayload:z4C,settingEntity:c5S,stringEntity:gCg,suggestedFeedbackChipStateEntity:TLC,transfer:RWu,trendingOfferEntity:xPd,videoDownloadContextEntity:WUS,videoOverviewAsyncDataEntity:TTu,videoPlaybackPositionEntity:PCd,votingEntity:J5l,ytMainChannelEntity:SZC,youchatPendingResponseEntity:Xm6,ytMainDownloadedVideoEntity:NL6,ytMainVideoEntity:End};g.V(dC,aFl);dC.prototype.D=function(m){return m};
dC.prototype.Y=function(m){if(m instanceof Uint8Array)throw A5f(0);return m};
g.V(O$,g.A);O$.prototype.observe=function(m){var M=this;this.observers.push(m);return function(){var e=M.observers.indexOf(m);e>=0&&M.observers.splice(e,1)}};
O$.prototype.Y=function(m){qOZ(this,m.data)};
O$.prototype.AG=function(){this.channel.close()};
var R7s,C1S=new g.hq("elementsCommand");var yV=new g.hq("entityBatchUpdate");var Mny=new g.hq("downloadStatusEntity");var WOT=new g.hq("mainPlaylistEntityActionMetadata");var Lj=new g.hq("mainVideoEntityActionMetadata");var fT6=new g.hq("musicPlaylistEntityActionMetadata");var vGs=new g.hq("musicTrackEntityActionMetadata");var PVC=new g.hq("localImageEntityActionMetadata");var om=new g.hq("playbackDataActionMetadata");var Cil=new g.hq("transferEntityActionMetadata");var KN6=new g.hq("videoPlaybackPositionEntityActionMetadata");var nMC;new g.FU;new g.FU;oMy.prototype.request=function(m,M,e){M=M===void 0?{}:M;return this.locks.request(m,M,function(I){return e(I)})};var Im=g.cS.caches,eE,lHy;M4.prototype.open=function(m){return Im.open(XIS(m))};
M4.prototype.has=function(m){return Im.has(XIS(m))};
M4.prototype.delete=function(m){return Im.delete(XIS(m))};
M4.prototype.match=function(m,M){var e=this,I,t,Y,b,r,q;return g.p(function(Z){switch(Z.L){case 1:return g.T(Z,e.keys(),2);case 2:I=Z.Y,t=g.P(I),Y=t.next();case 3:if(Y.done){Z.k7(5);break}b=Y.value;return g.T(Z,e.open(b),6);case 6:return r=Z.Y,g.T(Z,r.match(m,M),7);case 7:if(q=Z.Y)return Z.return(q);Y=t.next();Z.k7(3);break;case 5:return Z.return()}})};
g.V(TNT,M4);TNT.prototype.keys=function(){var m,M,e,I,t,Y,b,r,q;return g.p(function(Z){if(Z.L==1)return m=[],M=g.vW("CacheStorage keys"),g.T(Z,Im.keys(),2);e=Z.Y;I=g.P(e);for(t=I.next();!t.done;t=I.next()){Y=t.value;var F=Y.indexOf(":");b=F===-1?{NT:Y}:{NT:Y.substring(0,F),datasyncId:Y.substring(F+1)};r=b.NT;q=b.datasyncId;q===M&&m.push(r)}return Z.return(m)})};g.V(Y4,g.A);Y4.prototype.D=function(m){this.api.FC("onOfflineOperationFailure",m.data)};
Y4.prototype.B=function(m){this.api.publish("offlinetransferpause",m.data)};
Y4.prototype.AG=function(){var m;(m=this.L)==null||m.close();var M;(M=this.Y)==null||M.close()};Dyg.prototype.Au=function(){this.L&&QV(this)};
Dyg.prototype.zC=function(){this.Y&&this.Y.resolve();this.D=this.L=!1;this.nE()};var EFl=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var qT9="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var coS="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.V(DUg,B6);DUg.prototype.Y=function(m){return ZJ(m)?aTd(this,m):FK(m)?LNT(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.V(vwT,B6);vwT.prototype.Y=function(m){return FK(m)?gws(this,m):mUC(m)?mf9(this,m):Cj(m)?M76(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.k=egK.prototype;g.k.oeE=function(m){var M=this,e,I,t,Y;return g.p(function(b){if(!g.O(m.state,128))return b.k7(0);e=m.state.sX;var r=(I=e)==null?void 0:I.errorCode,q=(t=e)==null?void 0:t.xM;Y=r==="net.connect"&&q===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(r==null?0:r.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.T(b,M.ej(M.player.getVideoData().videoId,Y),0)})};
g.k.ej=function(m,M){var e=this;return g.p(function(I){if(I.L==1){if(e.Y)return I.return();e.Y=!0;return M==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(XK(e,m,!1,!0),I.k7(0)):g.T(I,TH(e,m),3)}g.ac(m,4);return g.T(I,e.L.ej(M),0)})};
g.k.uL=function(m){m.status===2?(m.status!==this.D&&(vFT(this.L),g.ac(m.videoId,2)),m.GG&&eXS(this.L,m.videoId,m.GG)):m.status===4?(TH(this,m.videoId),this.ej(m.videoId,m.bf?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):m.status===1&&MrZ(this.L);this.D=m.status;this.api.FC("localmediachange",{videoId:m.videoId,status:m.status})};
g.k.SO=function(){var m=this,M;return g.p(function(e){if(e.L==1){if(m.Y)return e.return();m.Y=!0;M=m.player.getVideoData().videoId;return g.T(e,TH(m,M),2)}return g.T(e,m.L.SO(),0)})};
g.k.gQ=function(m){switch(m){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.k.U=function(m){return this.api.K().U(m)};g.V(s$d,B6);s$d.prototype.Y=function(m){return ZJ(m)?qas(this,m):FK(m)?ZGS(this,m):mUC(m)?Fi0(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};UfS.prototype.L=function(m,M){var e=m.action.actionMetadata.priority-M.action.actionMetadata.priority;e===0&&(m.L<M.L?e=-1:m.L>M.L&&(e=1));return e};g.V(pj,g.A);pj.prototype.AG=function(){this.nE&&this.nE();g.A.prototype.AG.call(this)};
pj.prototype.createAction=function(m,M){var e=g.aK(m.entityKey).entityType,I=g.ki(16);return new Uy(e,I,m,M.actionId,M.rootActionId)};
pj.prototype.D4=function(m){var M=this,e,I,t,Y,b,r,q,Z,F;return g.p(function(C){if(C.L==1){if(M.pE())return C.return();I=(e=m.offlineOrchestrationActionWrapperEntity)!=null?e:new Set;t=[];Y=g.P(I);for(b=Y.next();!b.done;b=Y.next())r=b.value,q=g.aK(r),Z=q.entityId,ctS(M.L,Z)||t.push(r);return g.T(C,B3f(M,t),2)}F=C.Y;return g.T(C,PiK(M,F),0)})};
pj.prototype.retry=function(){var m=this;return g.p(function(M){return g.T(M,hg9(m),0)})};oFS.prototype.Cg=function(m,M){M=M===void 0?!0:M;var e=this,I,t,Y,b,r,q,Z,F;return g.p(function(C){switch(C.L){case 1:if(!e.L)return C.return();I=[];t=g.$W(e.L.L,M);Y=[];for(b={GV:0};b.GV<t.length;b={GV:b.GV},b.GV++)r=t[b.GV],q=e.L.Pi(r,"json3"),Z=g.zF(q,{withCredentials:!0,format:"RAW"},3,500).then(function(R){return function(H){H={metadata:g.S_(t[R.GV]),trackData:H.xhr.responseText};Y.push(H)}}(b)).VS(function(R){tD("Caption fetch error",R)}),I.push(Z);
return g.T(C,aiT(I),2);case 2:return g.bf(C,3),g.T(C,iP9(m,Y),5);case 5:g.ru(C,0);break;case 3:F=g.qZ(C),tD("Caption DB transaction error",F),g.Yd(C)}})};g.V(lk,g.A);lk.prototype.AG=function(){this.Y&&this.Y();g.A.prototype.AG.call(this)};
lk.prototype.D=function(m){var M=this,e,I,t,Y,b,r,q,Z;return g.p(function(F){I=(e=m.transfer)!=null?e:new Set;t=[];Y=g.P(I);for(b=Y.next();!b.done;b=Y.next())r=b.value,q=g.aK(r),Z=q.entityId,t.push(Z);return t.length===0?F.return():g.T(F,XsZ(M,t),0)})};g.V(Df9,g.A);g.k=Df9.prototype;g.k.AG=function(){this.BJ&&this.BJ();this.GO.dispose();this.B.dispose();this.fE&&g.Qs(this.X.Zh,this.fE);this.Rt&&g.Qs(this.X.Zh,this.Rt);g.A.prototype.AG.call(this)};
g.k.Tu4=function(m){var M=this,e,I,t;return g.p(function(Y){switch(Y.L){case 1:e=g.db(m,"transfer");if(M.L&&e===M.L.key){XK(M.T,M.C,!0);M.B.stop();Y.k7(0);break}return g.T(Y,Ll(M.Y,{mode:"readwrite",uS:!0},function(b){return A3(b,e,"transfer").then(function(r){if(r&&r.transferState!=="TRANSFER_STATE_COMPLETE"&&r.transferState!=="TRANSFER_STATE_FAILED")return r.transferState="TRANSFER_STATE_PAUSED_BY_USER",G2(b,r,"transfer").then(function(){return r})})}),3);
case 3:I=Y.Y;if(!I){Y.k7(0);break}if(!m||!M.D){Y.k7(5);break}return g.T(Y,H6(m,M.D,M.Y,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.T(Y,DJ(M,m),7);case 7:t=Y.Y,gMf({videoId:m,pZ:I,offlineModeType:t}),g.Yd(Y)}})};
g.k.zOY=function(){var m=this;if(this.L&&this.C){XK(this.T,this.C,!1);var M=this.L,e=(M==null?0:M.key)?g.aK(M.key).entityId:"";e&&this.D&&(new Promise(function(I,t){H6(e,m.D,m.Y,"DOWNLOAD_STATE_PAUSED").catch(function(Y){t(Y)})})).catch(function(I){tD("Download state setting error",I)})}this.B.stop()};
g.k.WG=function(){this.L?a40(this,this.L):AD(this)};
g.k.hT=function(m){var M=this;return g.p(function(e){switch(e.L){case 1:if(!M.L){e.k7(2);break}if(M.L.transferState==="TRANSFER_STATE_COMPLETE"||M.L.transferState==="TRANSFER_STATE_FAILED"||!m.transfer||!m.transfer.has(M.L.key)){e.k7(3);break}return g.T(e,gC(M.Y,M.L.key,"transfer"),4);case 4:M.L=e.Y;if(M.L){e.k7(3);break}return g.T(e,dfd(M),3);case 3:if(M.L)return e.return();case 2:return g.T(e,AD(M),0)}})};
g.k.ej=function(m,M){var e=this,I,t,Y,b,r;return g.p(function(q){switch(q.L){case 1:if(!e.L){$4(e,"onTransferFailure: "+m);q.k7(2);break}I=e.L;Y=((t=I)==null?0:t.key)?g.aK(I.key).entityId:"";a:switch(m){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Z=!1;break a;default:Z=!0}return Z&&IyC(e)?g.T(q,GH(e,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.T(q,
trT(e,m),5);case 5:if(!Y||!e.D){q.k7(2);break}return g.T(q,H6(Y,e.D,e.Y,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.T(q,DJ(e,Y),9);case 9:b=q.Y;rp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:Y,pZ:I,offlineModeType:b});if(!Y||!e.D){q.k7(2);break}return g.T(q,H6(Y,e.D,e.Y,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:x4(e),r=AD(e,!0),M&&M(r),g.Yd(q)}})};
g.k.SO=function(m){var M=this,e,I,t,Y,b,r,q,Z,F,C,R,H;return g.p(function(W){switch(W.L){case 1:if(!M.L){$4(M,"onMaybeTransferStreamsExpired");W.k7(2);break}return IyC(M)?g.T(W,GH(M,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.T(W,trT(M,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!M.D){W.k7(2);break}e=M.L;t=((I=e)==null?0:I.key)?g.aK(e.key).entityId:"";if(!t){W.k7(2);break}return g.T(W,H6(t,M.D,M.Y,"DOWNLOAD_STATE_FAILED"),2);case 9:return M.L||$4(M,"onMaybeTransferStreamsExpiredRetryAttempting"),
Y=M.L,r=((b=Y)==null?0:b.key)?g.aK(Y.key).entityId:"",g.T(W,DJ(M,r),10);case 10:return q=W.Y,rp({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:r,pZ:Y,offlineModeType:q}),Z=tnu(),g.Xf(Z,om,{isEnqueuedForExpiredStreamUrlRefetch:!0}),F=g.db(r,"playbackData"),C={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:F,actionMetadata:Z},R=N4(new Uy("playbackData",r,C)),g.T(W,vz(M.Y,R,"offlineOrchestrationActionWrapperEntity"),2);case 2:x4(M),H=AD(M,!0),
m&&m(H),g.Yd(W)}})};
var sSC={},YL0=(sSC.TRANSFER_STATE_TRANSFERRING=1,sSC.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,sSC);g.k=am.prototype;g.k.GB=function(){return this.C.promise};
g.k.Dp=function(){if(this.Y&&this.T)return this.C.promise;sES(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.k.B8=function(m){var M={};return M.playbackData=new DUg(m,this.V,this.L),M.transfer=new s$d(m,this.V),M.videoPlaybackPositionEntity=new vwT(m,this.V),M};
g.k.xm=function(){var m=this;return g.p(function(M){return m.Y?g.T(M,$fg(m.Y),0):M.k7(0)})};
g.k.B$=function(){var m=this,M,e;return g.p(function(I){if(I.L==1)return m.Y||m.T?g.T(I,m.GB(),2):I.return();m.S!==void 0&&(g.Ji(m.S),m.S=void 0);m.B!==void 0&&(g.Ji(m.B),m.B=void 0);(M=m.Y)==null||M.dispose();m.Y=void 0;(e=m.T)==null||e.dispose();m.T=void 0;m.api.FC("onOrchestrationLostLeader");m.C=new g.FU;g.Yd(I)})};
g.k.isOrchestrationLeader=function(){return this.D.L};
g.k.CT=function(){return g.p(function(m){return m.return(!1)})};
g.k.rX=function(m){var M=this.L;M.api.publish("offlinetransferpause",m);var e;(e=M.Y)==null||e.postMessage(m)};
g.k.WG=function(m){var M,e;return g.p(function(I){if(I.L==1)return g.T(I,mQ(),2);M=I.Y;if(!M)return I.return();e=g.db(m,"transfer");return g.T(I,Ll(M,{mode:"readwrite",uS:!0},function(t){var Y=A3(t,e,"transfer"),b=A3(t,g.db(m,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.iR.all([Y,b]).then(function(r){r=g.P(r);var q=r.next().value;var Z=r.next().value;return q&&q.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(q.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",G2(t,q,"transfer").then(function(){rp({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:m,pZ:q,offlineModeType:Z==null?void 0:Z.offlineModeType});return g.iR.resolve(null)})):g.iR.resolve(null)})}),0)})};
g.k.nf=function(m){m=m===void 0?43200:m;var M=this,e,I,t,Y,b,r,q,Z;return g.p(function(F){if(F.L==1)return M.X.xj()?g.T(F,mQ(),2):F.return(rXT());if(F.L!=3){e=F.Y;if(!e)return F.return([]);I=Date.now()/1E3;return g.T(F,Kl(e,"offlineVideoPolicy"),3)}t=F.Y;Y=[];b=g.P(t);for(r=b.next();!r.done;r=b.next())q=r.value,Number(q.lastUpdatedTimestampSeconds)+m<=I&&(Z=g.aK(q.key).entityId,Y.push(Z));return Y.length?F.return(dp(M,Y,M.nE,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):F.return([])})};
g.k.deleteAll=function(){return dp(this,["!*$_ALL_ENTITIES_!*$"],this.nE,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.k.refreshAllStaleEntities=function(m){var M=this;return g.p(function(e){return e.L==1?g.T(e,M.nf(m),2):e.return(e.Y)})};
g.k.setUpPositionSyncInterval=function(m){var M=this;this.B!==void 0&&(g.Ji(this.B),this.B=void 0);var e=m!=null?m:864E5;this.B=g.jK(function(){M.aT(e)},e)};
g.k.aT=function(m){var M=this,e,I,t,Y,b,r;return g.p(function(q){switch(q.L){case 1:return g.bf(q,2),g.T(q,pl.getInstance(),4);case 4:e=q.Y;if(!e)throw Error("prefStorage is undefined");return g.T(q,e.get("psi"),5);case 5:I=q.Y;Y=((t=I)==null?0:t.Wc)?Number(I.Wc)/1E3:0;b=Date.now();if(!(Y+m<=b)){q.k7(6);break}return g.T(q,dp(M,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ru(q,0);break;case 2:r=g.qZ(q),tD("Offline manager error",r),
g.Yd(q)}})};
g.k.Cf=function(){var m=this,M,e,I,t,Y,b,r;return g.p(function(q){if(q.L==1)return g.T(q,mQ(),2);if(q.L!=3)return(M=q.Y)?g.T(q,Kl(M,"transfer"),3):q.return([]);e=q.Y;I=[];t=g.P(e);for(Y=t.next();!Y.done;Y=t.next())b=Y.value,b.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&b.key&&(r=g.aK(b.key).entityId,I.push(r));return q.return(ZSl(m,I))})};
g.k.Ze=function(){return g.p(function(m){return m.return([])})};
g.k.q6=function(){return g.p(function(m){g.Yd(m)})};
g.k.o1=function(){return g.p(function(m){g.Yd(m)})};g.V(FO6,B6);FO6.prototype.Y=function(m){return ZJ(m)?RXu(this,m):FK(m)?kag(this,m):Cj(m)?UMC(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var Oy=[10];g.V(iSg,B6);iSg.prototype.Y=function(m){return ZJ(m)?fys(this,m):FK(m)?uUZ(this,m):Cj(m)?SL0(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var JX9=[10];g.V(nG9,B6);nG9.prototype.Y=function(m){return FK(m)?BSK(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.V(hXC,am);g.k=hXC.prototype;g.k.B8=function(m){var M=am.prototype.B8.call(this,m);M.mainVideoEntity=new iSg(m,this.V,this.L);M.mainPlaylistEntity=new FO6(m,this.V,this.L);M.mainDownloadsListEntity=new nG9(m,this.V,this.L);return M};
g.k.refreshAllStaleEntities=function(m,M){var e=this,I,t,Y,b,r,q,Z,F,C,R,H;return g.p(function(W){switch(W.L){case 1:I=[];if(!e.V.U("web_player_offline_playlist_auto_refresh")){W.k7(2);break}return g.T(W,ww9(e,m,M),3);case 3:I=W.Y;case 2:return g.T(W,pl.getInstance(),4);case 4:return t=W.Y,g.T(W,(Y=t)==null?void 0:Y.get("sdois"),5);case 5:return b=W.Y,g.T(W,(r=t)==null?void 0:r.get("lmqf"),6);case 6:q=W.Y;if(!b){W.k7(7);break}F=I;C=F.concat;return g.T(W,oGC(e,b,(Z=q)!=null?Z:"SD",m===0),8);case 8:I=
C.call(F,W.Y);case 7:return R=I,H=R.concat,g.T(W,am.prototype.refreshAllStaleEntities.call(e,m,M),9);case 9:return I=H.call(R,W.Y),W.return(I)}})};
g.k.CT=function(m){var M,e,I,t,Y,b,r,q;return g.p(function(Z){if(Z.L==1)return g.T(Z,mQ(),2);if(Z.L!=3)return(M=Z.Y)?g.T(Z,gC(M,g.o4,"mainDownloadsListEntity"),3):Z.return(!1);e=Z.Y;if((I=e)==null?0:(t=I.downloads)==null?0:t.length)for(Y=g.db(m,"mainVideoEntity"),b=g.P(e.downloads),r=b.next();!r.done;r=b.next())if(q=r.value,q.videoItem===Y)return Z.return(!0);return Z.return(!1)})};
g.k.Ze=function(){var m=this,M,e,I,t,Y,b,r,q;return g.p(function(Z){if(Z.L==1)return g.T(Z,mQ(),2);if(Z.L!=3)return(M=Z.Y)?g.T(Z,Kl(M,"downloadStatusEntity"),3):Z.return([]);e=Z.Y;I=[];t=g.P(e);for(Y=t.next();!Y.done;Y=t.next())b=Y.value,b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&b.key&&(r=g.aK(b.key).entityId,I.push(r));return I.length?(q={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Z.return(dp(m,I,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
q))):Z.return([])})};
g.k.o1=function(){var m;return g.p(function(M){return M.L==1?g.T(M,mQ(),2):(m=M.Y)?g.T(M,Ll(m,{mode:"readwrite",uS:!0},function(e){return DQ(e,"mainVideoEntity").then(function(I){var t=[];I=g.P(I);for(var Y=I.next();!Y.done;Y=I.next()){Y=Y.value;var b=void 0;(b=Y.userState)!=null&&b.playbackPosition||(b=g.aK(Y.key).entityId,b={key:g.db(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:"0"},t.push(G2(e,b,"videoPlaybackPositionEntity")),Y.userState={playbackPosition:b.key},t.push(G2(e,
Y,"mainVideoEntity")))}return g.iR.all(t)})}),0):M.return()})};
g.k.q6=function(){var m,M,e,I,t,Y,b,r,q,Z,F,C,R,H,W,N,y,n,E,B,w,x,l,Mw,e$,Id,bW,CO,tm,j$,g8,Q0,lW,LO,zK,L6,BS,S;return g.p(function(K6){if(K6.L==1)return g.T(K6,mQ(),2);if(K6.L!=3){m=K6.Y;if(!m)return K6.return();M=g.db("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.T(K6,Ll(m,{mode:"readonly",uS:!0},function(Ag){return g.iR.all([A3(Ag,M,"mainDownloadsListEntity"),A3(Ag,g.o4,"mainDownloadsListEntity"),DQ(Ag,"mainVideoEntity"),DQ(Ag,"mainPlaylistEntity")])}),3)}e=K6.Y;
I=g.P(e);t=I.next().value;Y=I.next().value;b=I.next().value;r=I.next().value;q=t;Z=Y;F=b;C=r;R=new Set;if((H=q)==null?0:(W=H.downloads)==null?0:W.length)for(N=g.P(q.downloads),y=N.next();!y.done;y=N.next())n=y.value,E=void 0,(B=(E=n.videoItem)!=null?E:n.playlistItem)&&R.add(B);if((w=Z)==null?0:(x=w.downloads)==null?0:x.length)for(l=g.P(Z.downloads),Mw=l.next();!Mw.done;Mw=l.next())e$=Mw.value,e$.videoItem&&R.add(e$.videoItem);Id=new Set;bW=[];CO=g.P(C);for(tm=CO.next();!tm.done;tm=CO.next()){j$=tm.value;
if(j$.videos)for(g8=g.P(j$.videos),Q0=g8.next();!Q0.done;Q0=g8.next())lW=Q0.value,(LO=JSON.parse(g.aK(lW).entityId).videoId)&&Id.add(LO);j$.key&&!R.has(j$.key)&&bW.push(j$.key)}zK=g.P(F);for(L6=zK.next();!L6.done;L6=zK.next())BS=L6.value,BS.key&&!R.has(BS.key)&&(S=g.aK(BS.key).entityId,Id.has(S)||bW.push(BS.key));return bW.length?g.T(K6,krS(m,bW),0):K6.k7(0)})};g.V(zXy,B6);zXy.prototype.Y=function(m){return ZJ(m)?Xws(this,m):FK(m)?pwT(this,m):Cj(m)?lyd(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var v6=[10];g.V(AXf,B6);AXf.prototype.Y=function(m){return ZJ(m)?$Ml(this,m):FK(m)?Gas(this,m):Cj(m)?ayS(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var gp=[10];g.V(LOs,B6);LOs.prototype.Y=function(m){return ZJ(m)?mzl(this,m):FK(m)?Mx9(this,m):Cj(m)?el0(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var KOS=[10];g.V(Kj,am);Kj.prototype.B8=function(m){var M=am.prototype.B8.call(this,m);M.musicTrack=new LOs(m,this.L);M.musicPlaylist=new AXf(m,this.L);M.musicAlbumRelease=new zXy(m,this.L);return M};
Kj.prototype.refreshAllStaleEntities=function(m,M){var e=this,I,t,Y;return g.p(function(b){if(b.L==1)return g.T(b,tx0(e,m,M),2);if(b.L!=3)return t=I=b.Y,Y=t.concat,g.T(b,am.prototype.refreshAllStaleEntities.call(e,m,M),3);I=Y.call(t,b.Y);return b.return(I)})};g.V(YnT,g.Fh);g.k=YnT.prototype;g.k.create=function(){var m=this;g.D(this,this.events);if(g.sg(this.V))this.L=new hXC(this.V,this.player);else if(g.XG(this.V)||g.qS(this.V))this.L=new Kj(this.V,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){m.Kx()});
this.events.Z(this.player,"videodatachange",function(){m.Kx()});
this.V.U("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.FG)};
g.k.uR=function(){return!1};
g.k.f9=function(m,M,e,I){var t=this;return g.p(function(Y){return t.L?Y.return(dp(t.L,m,M,e,I)):Y.return(Promise.reject())})};
g.k.deleteAll=function(){return this.L.deleteAll()};
g.k.nf=function(m){return this.L.nf(m)};
g.k.refreshAllStaleEntities=function(m){return this.L.refreshAllStaleEntities(m)};
g.k.setUpPositionSyncInterval=function(m){this.L.setUpPositionSyncInterval(m)};
g.k.rX=function(m){this.L.rX(m)};
g.k.WG=function(m){return this.L.WG(m)};
g.k.Kx=function(){var m=this,M;return g.p(function(e){M=m.player.getVideoData();return g.QQ(M)?ba9(M)&&m.Y!==M.clientPlaybackNonce?g.T(e,QSf(m,M),0):e.k7(0):e.return()})};
g.k.FG=function(m){var M=this,e,I,t,Y,b,r,q;return g.p(function(Z){if(Z.L==1)return e=M.player.getVideoData(),I=e.xA,g.Ri(m,2)||g.Ri(m,512)?g.T(Z,mQ(),2):Z.return();if(Z.L!=3){t=Z.Y;if(!t)return tD("PES is undefined"),Z.return();Y=e.videoId;return g.T(Z,gC(t,g.db(Y,"mainVideoEntity"),"mainVideoEntity"),3)}b=Z.Y;if(!b)return Z.return();r=Math.floor(I).toString();q={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:r}};return g.T(Z,M.f9([Y],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
q),0)})};
g.k.isOrchestrationLeader=function(){return this.L.isOrchestrationLeader()};
g.k.updateDownloadState=function(m,M){var e,I,t,Y;return g.p(function(b){if(b.L==1)return g.T(b,mQ(),2);e=b.Y;if(!e)return tD("PES is undefined"),b.return();I=g.aK(m);t=I.entityType;Y=I.entityId;return g.T(b,H6(Y,t,e,M,!0),0)})};g.Zw("offline",YnT);})(_yt_player);
